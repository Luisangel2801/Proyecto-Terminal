\setcounter{page}{1} % Iniciar la numeración de las páginas en este punto

\section{Resumen}

    La hipertensión arterial es una condición prevalente en México que requiere un monitoreo constante para prevenir complicaciones graves. Este proyecto presenta el desarrollo de un sistema no invasivo para la estimación de la presión arterial basado en el cálculo del Tiempo de Transmisión del Pulso (PTT), utilizando señales fisiológicas capturadas mediante sensores de electrocardiograma (ECG) y fotopletismografía (PPG).

    El sistema integra un dispositivo de adquisición de señales con ESP32, procesamiento y análisis de las señales para detectar eventos relevantes (picos R del ECG y picos y valles del pulso), cálculo de la presión arterial estimada y almacenamiento en la nube mediante Firebase. Se desarrolló también una aplicación móvil para que el usuario pueda visualizar y registrar sus mediciones de manera sencilla y accesible.

    Durante las pruebas, se identificó que el principal desafío fue la alta presencia de ruido en las señales analógicas, lo que afectó la precisión del cálculo de la presión arterial, con un margen de error estimado en $\pm30\%$. A pesar de ello, el proyecto demostró la viabilidad conceptual del método y estableció una base para futuras mejoras técnicas, como la implementación de circuitos en placas PCB, uso de componentes SMD y técnicas avanzadas de filtrado para mejorar la calidad de las señales.

    Este trabajo contribuye a la innovación en tecnologías biomédicas accesibles, proponiendo una alternativa para el monitoreo continuo y no invasivo de la presión arterial, con potencial para facilitar el autocuidado y mejorar la salud cardiovascular en poblaciones con acceso limitado a servicios médicos tradicionales.

\newpage
\section{Introducción}

    La hipertensión arterial representa un problema de salud pública en México debido a su alta prevalencia y a las graves complicaciones que puede ocasionar, como enfermedades cardiovasculares y accidentes cerebrovasculares. La medición y monitoreo constante de la presión arterial son fundamentales para la prevención y control de esta enfermedad, permitiendo detectar cambios a tiempo y facilitar intervenciones médicas oportunas.

    Sin embargo, los métodos tradicionales para medir la presión arterial requieren equipo especializado y personal capacitado, lo que limita la frecuencia y accesibilidad del monitoreo para muchas personas. Por ello, surge la necesidad de desarrollar alternativas no invasivas, portátiles y de bajo costo que permitan a los usuarios realizar un seguimiento continuo y cómodo de su salud cardiovascular.

    El presente proyecto propone una solución basada en la estimación de la presión arterial mediante el cálculo del Tiempo de Transmisión del Pulso (PTT) a partir de señales fisiológicas obtenidas con sensores de electrocardiograma (ECG) y fotopletismografía (PPG). Esta metodología permite medir la presión arterial de forma indirecta, facilitando un monitoreo con más frecuencia sin necesidad de equipo clínico tradicional.

    Además, se desarrolló una aplicación móvil que integra la adquisición, procesamiento y visualización de datos, así como el almacenamiento seguro de las mediciones en la nube mediante Firebase, lo que permite al usuario consultar su historial en cualquier momento y lugar.

    Con este proyecto se busca impulsar el uso de tecnologías accesibles para la salud digital, aportando una solución que podría ampliar el acceso al monitoreo cardiovascular continuo, reducir costos y mejorar la calidad de vida de las personas en México y en otros contextos con necesidades similares.

\newpage
\section{Antecedentes}

    \subsubsection*{A chest-based continuous cuffless blood pressure method: Estimation and evaluation using multiple body sensors \cite{bodySensor}.}

    El artículo analiza el desarrollo de un dispositivo no invasivo para la estimación de la presión arterial (PA) utilizando sensores colocados en el pecho utilizando la bioimpedancia (BImp) como alternativa a la fotopletismografía (PPG) para la extracción del tiempo de llegada del pulso (PAT), se tomaron cinco lecturas de tiempo de pulso diferentes y se pudo estimar la PA sistólica y diastólica. 
    
    Se analizaron los datos de 41 participantes en diversas condiciones fisiológicas, incluidos los cambios de postura y los resultados mostraron que la combinación de PAT con la frecuencia cardíaca 
    mejoró la precisión del cálculo de la PA, y las lecturas de PAT basadas en BImp fueron un 3\% más precisas que las basadas en PPG, lo que destaca el potencial de BImp para un control más eficaz de la PA.

    \subsubsection*{An Arterial Compliance Sensor for Cuffless Blood Pressure Estimation Based on Piezoelectric and Optical Signals \cite{piezoelectric}.}

    Este artículo propone el desarrollo de un pequeño sistema de monitoreo que integra una matriz de sensores piezoeléctricos y un sensor óptico que monitorea las señales fisiológicas de la arteria radial. El sistema hace el cálculo del tiempo de tránsito del pulso (PTT) y correlaciona la ecuación de Moens-Korteweg con la velocidad de onda de pulso (PWV) para estimar la presión arterial sistólica (PAS) y diastólica (PAD).

    En un experimento con 20 participantes se compararon dos métodos de estimación de la presión arterial, el primero utilizando el modelo de regresión y el segundo modelo $P-\beta$ basado en la ecuación de Moens-Korteweg.

    \subsubsection*{Development of IoT Based Cuffless Blood Pressure Measurement System \cite{Norsuriati_2021}.}

    El artículo presenta el desarrollo de un sistema IoT de medición de presión arterial sin uso de un baumanómetro, se propone un método basado en el tiempo de tránsito del pulso (PTT). Este método correlaciona el tiempo de retraso entre las señales fotopletismografía (PPG) registrada en la punta del dedo y el lóbulo de la oreja.

    Los datos son recolectados mediante un microcontrolador Arduino Uno y procesados con el software MATLAB para eliminar el ruido y obtener los picos de la señal PPG para calcular el PTT.
    
    Los resultados son mostrados en la aplicación ThinkSpeak y ThingView debido a que tiene la capacidad de almacenar y visualizar los datos en tiempo real. El error medio y la deviación estándar para la presión arterial sistólica (PAS) estimada es de $22,5 \pm 20,6$ mmHg y para la presión arterial diastólica (PAD) es de $1,6 \pm 1,2$ mmHg.

    \subsubsection*{Diseño de un sistema internet de las cosas (IoT) para el monitoreo de la presión arterial \cite{Estrada_2021}. }

    En este artículo se presenta los procesos de diseño y construcción de un prototipo biomédico IoT para el monitoreo de la presión arterial de pacientes en su lugar de residencia. El sistema consta en colocar un brazalete en el paciente a la altura del corazón, al cual se conecta una bomba de aire que infla el brazalete, junto con un sensor de presión diferencial MPX5050DP. Los datos obtenidos son convertidos de analógico a digital mediante un microcontrolador y enviados, a través de una API REST, al servidor web IoT ThinkSpeak, donde se almacenan y pueden visualizarse en tiempo real.

    \subsubsection*{Development of Real-Time Cuffless Blood Pressure Measurement Systems with ECG Electrodes and a Microphone Using \textit{Pulse Transit Time} (PTT) \cite{Electrodes_Microphone}.}

    El estudio habla sobre el desarrollo de un sistema de medición de la presión arterial en tiempo real sin uso de un baumanómetro, utilizando electrodos de ECG y un micrófono en lugar de un sensor de fotopletismografía (PPG). El sistema mide la onda de pulso sanguíneo en la arteria radial de la muñeca, calculando la presión arterial sistólica (SBP) y diastólica (DBP) mediante el tiempo de tránsito del pulso (PTT) entre el pico R del ECG y puntos característicos de la onda de pulso.
    
    Las estimaciones de SBP y DBP fueron comparables a las de un monitor de presión arterial comercial, con un error absoluto medio (MAE) de $2.72 \pm 3.42$ mmHg para SBP y $2.29 \pm 3.53$ mmHg para DBP.


\newpage
\section{Justificación}

En México, las enfermedades cardiovasculares representan la primera causa de muerte, siendo responsable de más de 220 mil fallecimientos en 2021 \cite{SSFallecimientos}. Entre los factores de riesgo más importantes para estas patologías se encuentra la hipertensión arterial, conocida también como el ``asesino silencioso'', ya que no presenta síntomas y puede pasar desapercibida durante años, hasta que desarrollan complicaciones graves como infartos o accidentes cerebrovasculares. Según la Encuesta Nacional de Salud y Nutrición (ENSANUT), cerca del 30\% de la población adulta en México padece hipertensión arterial \cite{ENSANUT}, pero una gran proporción de ellos no recibe un tratamiento adecuado o no se diagnostica a tiempo debido a la falta de acceso a un monitoreo continuo y preciso.

Los métodos para la medición de la presión arterial, como el baumanómetro, son invasivos y requieren de personal capacitado, lo que limita su uso en el monitoreo continuo de la presión arterial. Esta limitación es crítica en un país como México, donde el sistema de salud puede ser limitado, especialmente en zonas rurales y marginadas. Por lo tanto, es necesario desarrollar dispositivos no invasivos y de bajo coste que permitan a las personas monitorear su presión arterial de forma continua y precisa, para detectar y tratar a tiempo la hipertensión arterial y de esta forma prevenir complicaciones graves.

Este proyecto tiene como objetivo desarrollar un sistema basado en sensores para la estimación de la presión arterial de forma no invasiva, que permita a las personas monitorear su presión arterial de forma continua y precisa, y enviar los datos a un dispositivo móvil para la visualización y el almacenamiento de los registros para llevar un control de su salud cardiovascular. Facilitando así la detección temprana de la hipertensión arterial y la prevención de complicaciones graves asociadas a esta enfermedad.

El desarrollo de un sistema de monitoreo no invasivo de la presión arterial permitirá a las personas tener un mayor control de su salud cardiovascular, detectar a tiempo la hipertensión arterial y prevenir complicaciones graves asociadas a esta enfermedad, mejorando así su calidad de vida y reduciendo la carga de enfermedades cardiovasculares en México.


\newpage
\section{Objetivos}
    \subsection{Objetivo General}
    Desarrollar un dispositivo para estimar la presión arterial de forma no invasiva utilizando sensores.
    \subsection{Objetivos Específicos}
    \begin{itemize}
        \item Diseñar un dispositivo utilizando sensores para la obtención de datos fisiológicos.
        \item Enviar los datos mediante Bluetooth a un dispositivo móvil.
        \item Procesar los datos obtenidos para la estimación de la presión arterial.
        \item Visualizar los datos obtenidos en una aplicación android.
    \end{itemize}

\newpage
\section{Marco Teórico}

    \subsection{El sistema de conducción del corazón}

    El corazón es un órgano muscular que late de manera continua, bombeando sangre al resto del cuerpo. Lo que comúnmente conocemos como latido cardíaco es, en realidad, la contracción rítmica de las cuatro cavidades del corazón. Cada latido es generado por señales eléctricas que viajan a través de una vía específica dentro del corazón, lo que se puede registrar mediante un electrocardiograma (ECG). Este órgano está compuesto por cuatro cavidades: dos aurículas en la parte superior y dos ventrículos en la parte inferior. Estas cavidades están separadas por los septos interauricular e interventricular, que, en condiciones normales, impiden la mezcla de la sangre entre los lados derecho e izquierdo del corazón \cite{tresguerres_2005}.

    En la figura \ref{fig:corazon} se muestra la anatomía del corazón, donde se observan las cuatro cavidades del corazón y las válvulas. La sangre fluye a través de estas cavidades en un ciclo continuo, comenzando en la aurícula derecha, pasando al ventrículo derecho, luego a los pulmones para oxigenarse, regresando a la aurícula izquierda, pasando al ventrículo izquierdo y finalmente siendo bombeada al resto del cuerpo.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.5\textwidth]{img/Marco/corazon.jpg}
        \caption[Anatomía del corazón]{Anatomía del corazón\footnotemark}
        \label{fig:corazon}
    \end{figure}
    \footnotetext{Muestra la anatomía del corazón, donde se observan las cuatro cavidades del corazón y las válvulas. Imagen tomada de \texttt{The Texas Heart Institute}. [En línea]. Disponible en: \url{https://goo.su/uncyl}}

     Este proceso comienza en el nódulo senoauricular (nódulo SA), situado en la aurícula derecha. La señal eléctrica se propaga a las aurículas, provocando su contracción y el empuje de sangre hacia los ventrículos. Luego, la señal llega al nódulo auriculoventricular (nódulo AV) y se desplaza a través del haz de His, que se divide en ramas izquierda y derecha dentro de los ventrículos. Finalmente, la señal viaja por las fibras de Purkinje, que son fibras musculares especializadas que se encuentran en las paredes de los ventrículos, el cual provoca la contracción de los ventrículos, bombeando sangre a los pulmones y al resto del cuerpo. Este sistema actúa como el marcapasos natural del cuerpo, manteniendo un ritmo cardíaco normal de 60 a 100 latidos por minuto. Alteraciones en este sistema pueden resultar en ritmos cardíacos anormales y afectar el flujo sanguíneo del cerebro y otras partes del cuerpo \cite{SistemaConduccionMSD}.

     En la figura \ref{fig:sistemaConduccion} se muestra el sistema de conducción del corazón y los tiempos de conducción de los respectivos segmentos.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.7\textwidth]{img/Marco/sistemaConduccion.png}
        \caption[Sistema de conducción cardíaca y tiempos de conducción de los respectivos segmentos]{Sistema de conducción cardíaca y tiempos de conducción de los respectivos segmentos\footnotemark}
        \label{fig:sistemaConduccion}
    \end{figure}
    \footnotetext{Localización de las células marcapasos dentro del sistema de conducción del corazón. Imagen tomada de lecturio.com. [En línea]. Disponible en: \url{https://goo.su/MSZMxUj}}

    \subsection{Electrocardiograma (ECG)}
    Un electrocardiograma (ECG) es un estudio que registra el voltaje generado por los vectores de despolarización y repolarización de las células cardiacas en relación con el tiempo, es una herramienta útil para evaluar la función cardíaca y detectar problemas cardíacos \cite{ECG_Definicion}.

    Es una prueba no invasiva e indolora, que se realiza para detectar problemas cardíacos o controlar el estado del corazon. El ECG generalmente utiliza sensores (electrodos), colocados sobre la piel del pecho, pueden detectar señales eléctricas del corazón. Las señales de estos sensores se conectan a circuitos electrónicos simples con amplificadores, filtros y convertidores analógico-digitales, que registran la señal eléctrica y la muestran en un monitor o la imprimen para su posterior análisis.

    Las ondas del ECG son las siguientes:

    \begin{itemize}
        \item \textbf{Onda P}: Representa la despolarización auricular, es la suma de los vectores de despolarización de ambas aurículas.
        \item \textbf{Intervalo PR}: Representa el tiempo transcurrido desde la despolarización auricular, hasta la despolarización ventricular. Incluye la onda P y el segmento PR. Éste último elemento es una línea isoeléctrica, establecida gracias al retardo fisiológico que sufre la conducción eléctrica en el nodo aurículoventricular. Sin este retraso mencionado, las aurículas y los ventrículos se despolarizarían casi al mismo tiempo, siendo imposible el funcionamiento correcto del corazón para que la sangre pase por sus diferentes cavidades ordenadamente.
        \item \textbf{Onda Q}: Indica el inicio de la despolarización ventricular, específicamente el vector de despolarización septal.
        \item \textbf{Onda R}: Representa el segundo vector de despolarización, correspondiente a la pared libre del ventrículo izquierdo. Es normalmente la onda con mayor voltaje, debido a que el ventrículo izquierdo es el que mayor cantidad de células posee, por ende, la actividad eléctrica es mayor y el vector es más grande.
        \item \textbf{Onda S}: Corresponde al último vector de despolarización ventricular, originado en las bases de los ventrículos.
        \item \textbf{Complejo QRS}: Es la suma de los tres vectores de despolarización anteriores, y juntos representan a la despolarización ventricular.
        \item \textbf{Segmento ST}: Es un periodo de inactividad que separa la despolarización ventricular de la repolarización ventricular, va desde el final del complejo QRS hasta el comienzo de la onda T. 
        \item \textbf{Intervalo QT}: Se extiende desde el comienzo del complejo QRS hasta el final de la onda T y representa la sístole eléctrica ventricular, o lo que es lo mismo, el conjunto de la despolarización y repolarización ventricular. La medida de este intervalo depende de la frecuencia cardiaca, de forma que el intervalo QT se acorta cuando la frecuencia cardiaca es alta, y se alarga cuando la frecuencia cardiaca es baja. Por lo anterior, cuando se mide, es necesario corregirlo de acuerdo con la frecuencia cardíaca utilizando la fórmula de Bazett
        \item \textbf{Onda T}: Es la onda que representa la repolarización ventricular.
        \item \textbf{Onda U}: Es una onda de escaso voltaje que puede o no estar presente en el trazado del electrocardiograma. Se debe a la repolarización de los músculos papilares
        \item \textbf{Intervalo RR}: Es el intervalo que abarca desde una onda R, hasta la onda R de la siguiente despolarización, es decir dos ondas R sucesivas. En un paciente sano, debe permanecer a un ritmo constante. La medida de este intervalo dependerá de la frecuencia cardiaca.
    \end{itemize}

    En la figura \ref{fig:ECG_ondas} se muestra el ciclo completo de un electrocardiograma, con las ondas P, Q, R, S, T y U, y los intervalos PR, QRS, ST y QT.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Marco/ECG_ondas.png}
        \caption[Ciclo completo de un electrocardiograma]{Ciclo completo de un electrocardiograma\footnotemark}
        \label{fig:ECG_ondas}
    \end{figure}
    \footnotetext{Muestra el ciclo completo de un electrocardiograma, con las ondas P, Q, R, S, T y U, y los intervalos PR, QRS, ST y QT. Imagen tomada de encyclopedia.pub. [En línea]. Disponible en: \url{https://encyclopedia.pub/entry/52174}}

    El ECG tiene las características de baja frecuencia y concentración de energía, y la señal es débil, fácilmente perturbada por el ruido, como interferencias eléctricas, campos electromagnéticos externos, movimiento de electrodos (ruido instantáneo)  y el desplazamiento de la línea de base que es causado principalmente por la respiración. Estos ruidos dificultan el diagnóstico médico y pueden provocar errores en la identificación de enfermedades. Por ello, es esencial aplicar técnicas adecuadas para eliminar el ruido y mejorar la calidad de los datos de ECG muestreados \cite{AlMahamdy_2014}.

        \subsubsection{Derivaciones electrocardiográficas}
        Una derivación electrocardiográfica es una representación de la actividad eléctrica del corazón, que se obtiene al colocar electrodos en diferentes puntos del cuerpo. Estos electrodos detectan las variaciones de potencial eléctrico generadas por la despolarización y repolarización de las células cardíacas durante el ciclo cardíaco. La señal registrada por cada derivación proporciona información sobre la actividad eléctrica en diferentes regiones del corazón y permite identificar posibles anomalías o trastornos cardíacos.

        Existen dos tipos de derivaciones: unipolares y bipolares. Las derivaciones unipolares registran la diferencia de potencial entre un punto del cuerpo y un punto de referencia conocido como centro eléctrico, mientras que las derivaciones bipolares registran el potencial entre dos puntos específicos del cuerpo.

        En el plano frontal, todas las derivaciones pueden representarse mediante el triángulo de Einthoven, un triángulo equilátero que tiene como vértices los electrodos de las derivaciones estándar (I, II y III). Este triángulo se utiliza para describir la relación geométrica entre las derivaciones, y en su centro se encuentra el cero eléctrico, que representa un punto de referencia común para todas las derivaciones. Este modelo permite comprender cómo se registran las señales eléctricas en diferentes puntos del cuerpo y facilita la interpretación del electrocardiograma \cite{mauricio_2008}.

        En la figura \ref{fig:triangulo_Einthoven} se muestra el triángulo de Einthoven, que representa las derivaciones I, II y III, así como las derivaciones unipolares aVF, aVL y aVR. La posición de los electrodos en el triángulo de Einthoven es fundamental para la correcta interpretación del electrocardiograma, ya que cada derivación proporciona información específica sobre la actividad eléctrica del corazón en diferentes regiones.

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.8\textwidth]{img/Marco/triangulo.png}
            \caption[Representación gráfica del triángulo de Einthoven]{Representación gráfica del triángulo de Einthoven\footnotemark}
            \label{fig:triangulo_Einthoven}
        \end{figure}
        \footnotetext{Muestra la representación gráfica del triángulo de Einthoven, donde se observan las derivaciones I, II, III, aVF, aVL y aVR. Imagen tomada de \texttt{Wikipedia.org}. [En línea]. Disponible en: \url{https://goo.su/PfQb}}

    \subsection{Fotopletismografía (PPG)}
        \subsubsection{Principios de la fotopletismografía}
            La fotopletismografía (PPG, por sus siglas en inglés) es una técnica óptica que puede utilizarse para detectar cambios en el volumen sanguíneo \cite{Hertzman_1938}. Un PPG es un dispositivo simple que consta de una fuente de luz y un detector; se han desarrollado dispositivos PPG que utilizan luz de diferentes longitudes de onda e intensidades basadas en la tecnología de diodos emisores de luz (LED). La cantidad de energía transferida a la piel por la luz depende de su longitud de onda; por ejemplo, la luz verde se utiliza con frecuencia y tiene una buena relación señal-ruido \cite{Challoner_1979}. Además, las señales de luz roja, verde y azul (RGB) permiten determinar el pulso y las frecuencias respiratorias.

            La función del fotodetector es detectar y cuantificar la luz absorbida durante el flujo pulsátil y no pulsátil. Durante el flujo pulsátil, la luz se absorbe por el cambio en el flujo sanguíneo dentro de las arterias, que es sincrónico con un latido del corazón. Durante el flujo no pulsátil, la luz se absorbe por los tejidos de fondo. Por lo tanto, un fotodetector detecta el cambio volumétrico en el flujo sanguíneo en las arterias al detectar la diferencia de intensidad de luz. La medición de este cambio en la intensidad de la luz ayuda a analizar la funcionalidad del corazón.

            En los últimos treinta años, el número de artículos publicados sobre PPG ha aumentado significativamente, abarcando tanto la investigación básica como la aplicada. En todas estas publicaciones, la PPG ha sido elogiada como una técnica óptica no invasiva, de bajo costo y simple para medir parámetros fisiológicos aplicados en la superficie de la piel. \cite{PPG}.

            La popularidad de este tema se puede atribuir a la comprensión de que la PPG tiene implicaciones importantes para una amplia gama de aplicaciones. Entre muchas, ayuda en la detección de oxígeno en sangre, la evaluación cardiovascular y el control de los signos vitales. Además, la importante contribución de la PPG en los dispositivos portátiles ha elevado exponencialmente la popularidad y la facilidad de uso de la PPG \cite{allen_2007}.

        \subsubsection{Modos de medición}
            La tecnología PPG mide los cambios en el volumen de sangre en los tejidos durante un ciclo cardíaco mediante una fuente de luz. Esta medición volumétrica proporciona información importante sobre el sistema cardiovascular. Un sensor PPG consta principalmente de dos componentes electrónicos: un emisor de luz y un detector de intensidad lumínica.

            Generalmente, se utiliza un LED como emisor de luz y un fotodetector para captar los cambios en la intensidad lumínica. Un pulso PPG correspondiente a un latido del corazón que incluye las fases sistólica y diastólica. Durante la fase sistólica, el corazón se contrae y empuja la sangre rica en oxígeno hacia los tejidos y órganos, lo que incrementa el volumen de sangre en las arterias. Esto provoca que las células sanguíneas absorban más luz, por lo que la cantidad de luz detectada por el fotodetector es menor. En cambio, durante la fase diastólica, el corazón se relaja y la sangre regresa a él, disminuyendo el volumen sanguíneo en las arterias, como resultado, se absorbe menos luz y el fotodetector registra un aumento en la intensidad lumínica.\cite{Hiiberia_2023}.

            Dependiendo de la aplicación y la ubicación del sensor, el PPG se puede usar en modo transmisivo o en modo de reflexión.

            \begin{enumerate}
                \item [a] Cuando un fotodetector y un LED se colocan en lados opuestos de un dedo para detectar la luz transmitida, este arreglo se conoce como modo transmisivo. En este modo, la sonda está configurada de manera que el fotodetector y el LED se enfrentan con una capa de tejido entre ellos. La detección en modo transmisivo depende de la luz que atraviesa las partes del cuerpo, por lo que se prefieren estructuras delgadas como el lóbulo de la oreja y el dedo.
                \item [b] Cuando el fotodetector y el LED se colocan en el mismo lado de un dedo para detectar la luz reflejada, se utiliza el modo reflectivo. En este arreglo, ambos sensores se sitúan uno al lado del otro con una pequeña separación. Por lo tanto, el modo reflectivo puede emplearse en cualquier parte del cuerpo, como la frente o la muñeca.
            \end{enumerate}

            \begin{figure}[H]
                \centering
                \begin{subfigure}[b]{0.45\linewidth}
                    \includegraphics[width=\linewidth]{img/Marco/PPG_transmisivo.png}
                    \caption{Sensor PPG en modo de transmisión}
                    \label{fig:PPG_transmisivo}
                \end{subfigure}
                \begin{subfigure}[b]{0.45\linewidth}
                    \includegraphics[width=\linewidth]{img/Marco/PPG_reflexion.png}
                    \caption{Sensor PPG en modo de reflexión}
                    \label{fig:PPG_reflexion}
                \end{subfigure}
                \caption[Modos de medición de la fotopletismografía]{Modos de medición de la fotopletismografía\footnotemark}
                \label{fig:modosMedicionPPG}
            \end{figure}
            \footnotetext{Muestra la posición de los sensores PPG en modo de transmisión y en modo de reflexión, los dos modo se utiliza para medir la fotopletismografía. Imagen tomada de aiva.hi. [En línea]. Disponible en: \url{https://goo.su/pg8UGx}}

            \subsubsection{Forma de onda de un PPG}

            En la figura \ref{fig:PPG} se muestra la señal característica de un fotopletismógrado, la cual está directamente relacionada con la frecuencia cardíaca, donde cada periodo de la señal corresponde a una pulsación del corazon.

            La señal representa dos picos por cada periodo, el pico mayor representa la presión sistólica, y el segundo pico representa el inicio de la presión diastólica cuyo valor es el mínimo de la curva \cite{Celi_2011}.

            Para calcular la frecuencia cardíaca (FC) a partir de la señal PPG, se utiliza la ecuación~\ref{eq:FrecienciaCardiaca}, donde el intervalo entre pico a pico es el tiempo transcurrido entre dos pulsaciones del corazón.

            \begin{equation}
                \label{eq:FrecienciaCardiaca}
                FC = \frac{60}{\textit{Intervalo entre picos}}
            \end{equation}

            En la figura \ref{fig:PPG} se observa que la señal tiene una frecuencia de 1.5 Hz, lo que corresponde a 90 latidos por minuto.

            \begin{figure}[H]
                \centering
                \includegraphics[width=0.7\textwidth]{img/Marco/PPG_senial.png}
                \caption[Modelo matemático de una señal pura de una fotopletismografía]{Modelo matemático de una señal pura de una fotopletismografía\footnotemark}
                \label{fig:PPG}
            \end{figure}
            \footnotetext{Muestra una representación de una señal pura de una fotopletismografía, donde se observa la forma de onda de la señal con una frecuencia de 1.5 Hz, que representa 90 latidos por minuto. Imagen tomada del articulo ``Body sensor network for mobile health monitoring, a diagnosis and anticipating system''. [En línea]. Disponible en: \url{https://doi.org/10.1109/jsen.2015.2464773}}

        
        \subsubsection{Componente AC y DC de la señal PPG}
            La figura \ref{fig:PPG_AC_DC} muestra un ejemplo de una forma de onda fotopletismográfica, que tiene componentes de corriente continua (DC) y corriente alterna (AC). El componente DC de la forma de onda PPG corresponde a la señal óptica transmitida o reflejada del tejido y depende de la estructura del tejido y del volumen promedio de la sangre arterial y venosa. El componente DC cambia lentamente con la respiración, mientras que el componente AC fluctúa de acuerdo con los cambios en el volumen sanguíneo que ocurren entre las fases sistólica y diastólica del ciclo cardíaco \cite{Tamura_2019}.

            Cuando el corazón bombea sangre durante la sístole, el aumento del volumen sanguíneo en los tejidos periféricos provoca una mayor absorción de la luz o una menor reflexión, lo que da lugar a una desviación hacia abajo en la forma de onda PPG. Durante la diástole, cuando el corazón se relaja, el volumen sanguíneo disminuye, lo que da lugar a una desviación hacia arriba en la forma de onda PPG. La tecnología basada en PPG calcula las mediciones en función de los cambios reflejados en la forma de onda \cite{Cabessa_2024}.

            \begin{figure}[H]
                \centering
                \begin{subfigure}[b]{0.45\linewidth}
                    \includegraphics[width=\linewidth]{img/Marco/PPG_AC_DC.png}
                \end{subfigure}
                \begin{subfigure}[b]{0.45\linewidth}
                    \includegraphics[width=\linewidth]{img/Marco/PPG_Componente_AC_DC.png}
                \end{subfigure}
                \caption[Componente AC y DC de la señal PPG]{Componente AC y DC de la señal PPG\footnotemark}
                \label{fig:PPG_AC_DC}
            \end{figure}
            \footnotetext{Muestra un ejemplo de forma de onda de la señal PPG, donde se observa el componente AC y DC de la señal. Imagen tomada del artículo ``Wearable Photoplethysmographic Sensors—Past and Present''. [En línea]. Disponible en: \url{https://doi.org/10.3390/electronics3020282}}

        \subsubsection{Longitud de onda de la luz emitida}
            La piel del cuerpo está compuesta principalmente por tres capas de tejido: la epidermis, la dermis y la hipodermis. Debido a la absorción, solo las ondas de luz con una longitud de onda mayor pueden penetrar a través de todas ellas. La hemoglobina oxigenada absorbe la luz infrarrojo (NIR), mientras que la hemoglobina desoxigenada absorbe luz en la longitud de onda roja. Como resultado, los PPG que emplean LED y fotodetectores con longitudes de onda NIR y roja se utilizan comúnmente en el control clínico para calcular la concentración de hemoglobina.

            Sin embargo, el movimiento del paciente influye en la precisión de la medición y está relacionado con la longitud de onda de la luz utilizada. La luz de longitud de onda más larga, como el infrarrojo, se ve más afectada por el movimiento debido a que penetra profundamente en el tejido. Por otro lado, la luz de longitud de onda más corta (luz verde) generalmente está libre de los efectos del movimiento, ya que penetra menos en el tejido corporal. Por lo tanto, para mitigar el impacto del movimiento y la absorción de luz por los tejidos, se ha propuesto el uso de PPG basados en sensores ópticos de múltiples longitudes de onda para detectar variaciones en el flujo sanguíneo a diferentes profundidades de la piel. \cite{Hiiberia_2023}.

            \begin{figure}[H]
                \centering
                \includegraphics[width=0.6\textwidth]{img/Marco/PPG_luz.jpg}
                \caption[Penetración de las longitudes de onda de la luz en la piel]{Penetración de las longitudes de onda de la luz en la piel\footnotemark}
                \label{fig:PPG_longitud_onda}
            \end{figure}
            \footnotetext{Muestra la penetración de la luz en la piel, donde se observa que la luz de longitud de onda más larga (infrarroja) penetra más en la piel que la luz de longitud de onda más corta (Azul). Imagen tomada de Journal of Clinical Monitoring and Computing. [En línea]. Disponible en: \url{https://goo.su/jnUP8yi}}

            Dentro de la región visible, el pico de absorción dominante está en la región azul del espectro, seguido de la región verde-amarilla (500-600 nm), correspondiente a los glóbulos rojos. La luz de longitudes de onda más cortas es absorbida fuertemente por la melanina. El agua absorbe la luz en las regiones ultravioleta e infrarroja (IR) más largas. La luz roja (660 nm) e IR (940nm) pasa a través del tejido y la sangre. Por lo tanto, la luz IR se ha utilizado en sensores PPG.
        
            En la última década, la eficiencia de los LED ha aumentado y su voltaje directo ha disminuido, lo que resulta en un mayor número de lúmenes por watt. Gracias a la iluminación de alta potencia, la variación en el ciclo cardíaco entre las fases sistólica y diastólica es más pronunciada en la longitud de onda verde. Por ello, la luz verde se ha empleado en sensores PPG para medir la frecuencia cardíaca y la saturación de oxígeno en la sangre. \cite{Tamura_2019}.

    \subsection{Presión Arterial}
    La presión arterial es la fuerza que ejerce la sangre contra las paredes de las arterias. Se mide en milímetros de mercurio (mmHg) y se expresa mediante dos valores: la presión sistólica y la presión diastólica. Esta medición se realiza con un baumanómetro \cite{PresionArterialDefinicion}.

    La presión sistólica, se produce cuando el corazón se contrae, impulsando la sangre y aumentando la presión sobre las arterias. La presión diastólica, se registra durante la fase de relajación del corazón, cuando la presión sobre las arterias disminuye \cite{fernandez_presion}.
    
    Se considera que una presión arterial normal es de 120/80 mmHg. La hipertensión se define con valores de 140/90 mmHg o superiores, mientras que la hipotensión se establece en 90/60 mmHg o inferiores \cite{DOF}.

    En la tabla~\ref{tab:PA_categoria} se presentan las categorías de presión arterial según la clasificación de la \textit{American Heart Association (AHA)} \footnote{Muestra las categorías de la presión arterial, donde se observa la presión arterial normal, elevada, hipertensión grado 1, hipertensión grado 2 y crisis hipertensiva. Información tomada de \textit{American Heart Association}. [En línea]. Disponible en: \url{https://goo.su/tBpC}}.

    \begin{table}[H]
        \begin{center}
            \begin{tabularx}{\columnwidth}{>{\raggedright\arraybackslash}c | c | c | c}
                \textbf{Categoría de la Presión Arterial} & \textbf{Sistólica (mm Hg)} & \textbf{y/o} & \textbf{Diastólica (mm Hg)}\\ \hline
                Normal & Menos de 120 & y & Menos de 80 \\
                Elevada & 120-129 & y & Menos de 80 \\
                Hipertensión Grado 1 & 130-139 & o & 80-89 \\
                Hipertensión Grado 2 & 140 o más & o & 90 o más \\
                Crisis hipertensiva & Más de 180 & y/o & Más de 120 \\
            \end{tabularx}
            \caption{Categorías de presión arterial}
            \label{tab:PA_categoria}
        \end{center}
    \end{table}

    La hipertensión arterial, conocida como el ``asesino silencioso'' por ser asintomática en sus primeras etapas, suele pasar desapercibida hasta que se presentan complicaciones graves. Es la enfermedad de mayor prevalencia a nivel mundial y aumenta significativamente el riesgo cardiovascular. Un diagnóstico temprano, junto con el cumplimiento de las metas terapéuticas, es fundamental para reducir de forma importante el riesgo de complicaciones \cite{archivosCardiologia_2016}.

        \subsubsection{Medición de la presión arterial}
        La presión arterial, también conocida como tensión arterial, se mide habitualmente de forma no invasiva mediante un dispositivo llamado esfigmomanómetro. Este instrumento consta de un brazalete inflable, generalmente colocado en el brazo a la altura del corazón, conectado a un manómetro que registra la presión.

        El brazalete se utiliza para ocluir temporalmente el flujo sanguíneo en la arteria braquial, mientras que el manómetro indica la presión necesaria para lograr esta oclusión. Con este dispositivo se obtienen dos valores clave de la presión arterial:

        \begin{itemize}
            \item \textbf{Presión sistólica} (la más alta), que corresponde a la fuerza con la que el corazón impulsa la sangre durante la sístole.
            \item \textbf{Presión diastólica} (la más baja), que refleja la presión en las arterias cuando el corazón está en reposo, permitiendo el retorno de la sangre.
        \end{itemize}

        Ambos valores se expresan en milímetros de mercurio (mmHg) y se presentan en formato “Presión Sistólica / Presión Diastólica”.

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{img/Marco/medirPA.png}
            \caption[Principio de medición de la presión arterial]{Principio de medición de la presión arterial\footnotemark}
            \label{fig:medirPA}
        \end{figure}
        \footnotetext{Muestra el principio de medición de la presión arterial, donde se observa como el brazalete inflable es colocado en el brazo y el manómetro registra la presión.}

        La medición con un esfigmomanómetro analógico sigue un método conocido como \textbf{auscultatorio}, que consiste en inflar el brazalete por encima de la presión arterial del paciente para detener temporalmente el flujo sanguíneo en las arterias del brazo. Posteriormente, se libera gradualmente la presión del brazalete mientras se escuchan los \textbf{sonidos de Korotkoff} mediante un estetoscopio colocado sobre la arteria braquial \cite{Gill_2018}.

        \subsubsection{Sonidos de Korotkoff}
        Los sonidos de Korotkoff son ruidos generados por el flujo sanguíneo al restablecerse gradualmente tras liberar la presión del brazalete. Estos sonidos se dividen en cinco fases características: 

        \begin{enumerate}
            \item \textbf{Fase I}: Aparición de los primeros ruidos, que aumentan progresivamente en intensidad.
            \item \textbf{Fase II}: Los ruidos adquieren un carácter soplante y pueden disminuir en intensidad o desaparecer brevemente.
            \item \textbf{Fase III}: Los ruidos se vuelven claros y alcanzan su máxima intensidad.
            \item \textbf{Fase IV}: Los ruidos disminuyen bruscamente en intensidad y se tornan más graves o soplantes.
            \item \textbf{Fase V}: Es el momento en que desaparece completamente cualquier sonido; este nivel marca el valor de la presión diastólica.
        \end{enumerate}

        El primer sonido de Korotkoff (Fase I) señala el valor de la presión sistólica, mientras que el momento en que desaparecen el último sonido (Fase V) indica la presión diastólica \cite{Gill_2018}. 


    \subsection{Amplificadores}
    La mayoría de las señales bioeléctricas del cuerpo humano son señales con una magnitud del orden de máximo $5 mV_{pp}$ (milivolts pico a pico) y para poder ser registradas y analizadas, es necesario amplificarlas \cite{Diaz_amplificacion_señales}.

        \subsubsection{Amplificador operacional}
            Los amplificadores operacionales\footnote{``Introducción al amplificador operacional (OpAmp) - Amplificadores operacionales'', Solución Ingenieril. [En línea]. Disponible en: \url{https://goo.su/zbbKl}} son dispositivos electrónicos que se utilizan para amplificar señales eléctricas. Estos dispositivos tienen dos entradas, una inversora y otra no inversora, y una salida. La salida del amplificador operacional es proporcional a la diferencia de voltaje entre las dos entradas multiplicada por un factor de ganancia. La ganancia de un amplificador operacional se puede ajustar mediante la selección de resistencias externas.

            En la figura \ref{fig:Amplificador_Operacional} se observa el contenido de un amplificador operacional, con sus dos entradas, la ganancia de voltaje y la salida.

            \begin{figure}[H]
                \centering
                \includegraphics[width=0.5\textwidth]{img/Marco/Amplificador_Operacional.png}
                \caption[Terminales de entrada y salida de un amplificador operacional]{Terminales de entrada y salida de un amplificador operacional\footnotemark}
                \label{fig:Amplificador_Operacional}
            \end{figure}
            \footnotetext{Muestra el símbolo electrónico de un amplificador operacional, con sus dos entradas, la ganancia de voltaje y la salida.}

            \begin{table}[H]
                \centering
                \begin{tabular}{ c | l }
                    Terminal & Descripción \\ \hline
                    $V_+$ & Entrada no inversora \\
                    $V_-$ & Entrada inversora \\
                    $V_{S+}$ & Alimentación positiva \\
                    $V_{S-}$ & Alimentación negativa \\
                    $V_{out}$ & Salida \\
                    $Gv_{in}$ & Ganancia de voltaje \\
                \end{tabular}
                \caption{Terminales del amplificador operacional}
                \label{tab:terminales_amplificador}
            \end{table}

        \subsubsection{Amplificador Inversor}
            El amplificador inversor \footnote{``Amplificador inversor - Amplificadores operacionales'', Solución Ingenieril. [En línea]. Disponible en: \url{https://goo.su/eJTCVj}} es una configuración de amplificador operacional en la que la señal de entrada se aplica a la terminal inversora. En esta configuración, la salida está desfasada 180 grados con respecto a la entrada.

            El amplificador inversor se configura conectando la señal de entrada a la terminal inversora mediante una resistencia $R_i$. La salida del amplificador operacional retroalimenta a la terminal inversora a través de una resistencia $R_f$, como se muestra en la figura~\ref{fig:Amplificador_Inversor}.
            
            \begin{figure}[H]
                \centering
                \includegraphics[width=0.5\textwidth]{img/Marco/Amplificador_Inversor.png}
                \caption[Amplificador inversor]{Amplificador inversor\footnotemark}
                \label{fig:Amplificador_Inversor}
            \end{figure}
            \footnotetext{Muestra el diagrama esquemático de un amplificador inversor.}

            La ganancia del amplificador inversor se puede calcular mediante la ecuación~\ref{eq:ganancia_inversor}.

            \begin{equation}
                \label{eq:ganancia_inversor}
                G = -\frac{R_f}{R_i}
            \end{equation}

            Donde $G$ es la ganancia del amplificador, $R_f$ es la resistencia de retroalimentación y $R_i$ es la resistencia de entrada.

        \subsubsection{Amplificador No Inversor}
            El amplificador no inversor\footnote{``Amplificador No inversor - Amplificadores operacionales'', Solución Ingenieril.[En línea]. Disponible en: \url{https://goo.su/8XuqHr}} es una configuración de amplificador operacional en la que la señal de entrada se aplica a la terminal no inversora. La salida de esta configuración está en fase con la entrada, y su amplitud es proporcional a la ganancia del amplificador.

            El amplificador no inversor se configura conectando la señal de entrada a la terminal no inversora, esto nos indica que la ganancia será positiva (al contrario del inversor). La salida del amplificador operacional se retroalimenta a la terminal inversora a través de una resistencia $R_f$, como se muestra en la figura~\ref{fig:Amplificador_No_Inversor}.

            \begin{figure}[H]
                \centering
                \includegraphics[width=0.5\textwidth]{img/Marco/Amplificador_No_Inversor.png}
                \caption[Amplificador no inversor]{Amplificador no inversor\footnotemark}
                \label{fig:Amplificador_No_Inversor}
            \end{figure}
            \footnotetext{Muestra el diagrama esquemático de un amplificador no inversor.}

            La ganancia del amplificador no inversor se puede calcular mediante la ecuación~\ref{eq:ganancia_no_inversor}.

            \begin{equation}
                \label{eq:ganancia_no_inversor}
                G = \frac{R_f}{R_i} + 1
            \end{equation}

            Donde $G$ es la ganancia del amplificador, $R_f$ es la resistencia de retroalimentación y $R_i$ es la resistencia de entrada.

        \subsubsection{Amplificador Diferencial}
            El amplificador diferencial\footnote{W. Storr, ``Differential amplifier - the voltage subtractor'', Basic Electronics Tutorials. [En línea]. Disponible en: \url{https://goo.su/vDsY3K}} es un tipo de amplificador operacional cuya característica principal radica en su capacidad de amplificar la diferencia de voltaje entre sus dos entradas mientras rechaza las señales comunes presentes en ambas (CMRR, por sus siglas en inglés). En la figura~\ref{fig:Amplificador_Diferencial} se muestra el diagrama esquemático de un amplificador diferencial.

            \begin{figure}[H]
                \centering
                \includegraphics[width=0.5\textwidth]{img/Marco/Amplificador_Diferencial.png}
                \caption[Amplificador diferencial]{Amplificador diferencial\footnotemark}
                \label{fig:Amplificador_Diferencial}
            \end{figure}
            \footnotetext{Muestra el diagrama esquemático de un amplificador diferencial, con una ganancia de $\frac{R2}{R1}$.}

            El voltaje de salida ($v_0$) está determinado por la ecuación~\ref{eq:voltaje_diferencial}.

            \begin{equation}
                \label{eq:voltaje_diferencial}
                v_0 = (1 + \frac{R2}{R1}) \cdot \frac{R3}{R3 + R4} \cdot v2 - \frac{R2}{R1} \cdot v1
            \end{equation}

            Para optimizar el rendimiento del amplificador, se suele implementar una configuración simétrica donde las resistencias cumplen la condición $R1 = R3$ y $R2 = R4$. De esta forma, la ecuación~\ref{eq:voltaje_diferencial} se simplifica a la ecuación~\ref{eq:voltaje_diferencial_simplificada}.

            \begin{equation}
                \label{eq:voltaje_diferencial_simplificada}
                v_0 = \frac{R2}{R1} \cdot (v2 - v1)
            \end{equation}

            La ganancia del amplificador diferencial se puede calcular mediante la ecuación~\ref{eq:ganancia_diferencial}.

            \begin{equation}
                \label{eq:ganancia_diferencial}
                G = \frac{R2}{R1}
            \end{equation}

        \subsubsection{Amplificador de Instrumentación}
            Para amplificar señales bioeléctricas, como las del ECG, se requieren dos características en un amplificador: la primera es que presente una alta impedancia en sus terminales de entrada (elimina posibles caídas de voltaje de la señal cardiaca que den como resultado la reducción o anulación de su amplitud), y la segunda es que solamente amplifique la diferencia de voltaje existente entre dichas terminales. 
            
            El amplificador que reúne las dos caracteríasticas mencionadas es el amplificador de instrumentación\footnote{``Práctica 4 - El amplificador de instrumentación básico'', Universidad Michoacana de San Nicolás de Hidalgo Facultad de Ingeniería Eléctrica. [En línea]. Disponible en: https://goo.su/n7zlBm}.

            Para hacer posible lo anterior, todos los amplificadores de instrumentación se basan en el diseño mostrado en la figura~\ref{fig:Amplificador_Instrumentacion} que tiene una etapa con amplificadores no inversores (brindan alta impedancia) y enseguida una etapa de amplificación diferencial (casi siempre unitaria) \cite{Diaz_amplificacion_señales}.

            La expresión para calcular la ganancia y el voltaje de un amplificador de instrumentación se muestra en la ecuación~\ref{eq:ganancia_amplificador_instrumentación}.

            \begin{equation}
                \label{eq:voltaje_amplificador_instrumentación}
                v_0 = (1 + \frac{2R1}{RG}) \cdot (v2 - v1)
            \end{equation}

            \begin{equation}
                \label{eq:ganancia_amplificador_instrumentación}
                G = 1 + \frac{2R1}{RG}
            \end{equation}

            \begin{figure} [H]
                \centering
                \includegraphics[width=0.5\textwidth]{img/Marco/Amplificador_Intrumentacion.png}
                \caption[Amplificador de Instrumentación]{Amplificador de Instrumentación\footnotemark}
                \label{fig:Amplificador_Instrumentacion}
            \end{figure}
            \footnotetext{Diagrama de los elementos básicos que conforman las dos etapas en un amplificador de instrumentación. Imagen tomada de \textit{Fundamentals of operational amplifiers and linear integrated circuits}, p. 34.}

        \subsubsection{Amplificador de Intrumentación AD620}
            El amplificador de instrumentación AD620, es un amplificador de precisión de bajo costo y bajo consumo de energía fabricado por Analog Devices, que se utiliza para amplificar señales de baja amplitud y alta impedancia, como las señales ECG \cite{AD620_AnalogDevices,AD620_DigiKey}.

            \begin{figure}[H]
                \centering
                \includegraphics[width=0.8\textwidth]{img/Marco/AD620.png}
                \caption[Diagrama esquemático del amplificador de instrumentos AD620.]{Diagrama esquemático del amplificador de instrumentos AD620\footnotemark}
                \label{fig:AD620}
            \end{figure}
            \footnotetext{Muestra que el amplificador de instrumentación AD620 es equivalente a un amplificador diferencial conectado a dos amplificadores no inversores. Imagen tomada del artículo \textit{Axial and Lateral Small Strain Measurement of Soils in Compression Test using Local Deformation Transducer} de la revista \textit{Journal of Engineering and Technological Sciences}. [En línea]. Disponible en: \url{https://goo.su/fHljmIK}}

            \hfill \break
            Características del AD620:
            \begin{itemize}
                \item \textbf{Ganancia configurable:} Ajustable de 1 a 10,000 mediante una resistencia externa.
                \item \textbf{Bajo Nivel de Ruido:} Minimiza errores en la señal amplificada, asegurando una representación precisa de la actividad eléctrica cardíaca.
                \item \textbf{Baja Corriente de Polarización de Entrada:} Con una tensión de polarización máxima de $50 \mu V$ y una deriva mínima de $0,6 \mu V / ^{\circ} C$.
                \item \textbf{Bajo Consumo de Potencia:} Consume un máximo de $1,3 mA$, adecuado para dispositivos portátiles o alimentados por batería.
                \item \textbf{Rango de Voltaje de Alimentación:} Funciona con voltajes de $\pm 2,3 V$ a $\pm 18 V$.
            \end{itemize}

            El AD620 es una gran alternativa al arreglo tradiccional de tres amplificadores operacionales, ya que ofrece una mayor precisión y estabilidad, y requiere menos componentes externos. 

            \begin{figure}[H]
                \centering
                \includegraphics[width=0.6\textwidth]{img/Marco/Amplificador_AD620_comparacion.png}
                \caption[Comparación de la taza de error entre el AD620 y un arreglo de amplificadores de instrumentación.]{Comparación de la taza de error entre el AD620 y un arreglo de amplificadores de instrumentación\footnotemark}
                \label{fig:Amplificador_AD620_comparacion}
            \end{figure}
            \footnotetext{Muestra la diferencia en la taza de error por corriente suministrada de un amplificador de instrumentación AD620 y un arreglo de amplificadores de instrumentación convencional. Imagen tomada del Datasheet del AD620. [En línea]. Disponible en: \url{https://goo.su/ZhlyZ}}

            El componente cuenta con una entrada inversora (pin 2), una no inversora (pin 3), dos fuentes de alimentación (pin 4 y 7), una referencia o polo a tierra (pin 5), y una salida de la señal amplificada (pin 6). La ganancia del AD620 se puede ajustar mediante una resistencia externa conectada entre el pin 1 y el pin 8.
            \begin{figure}[H]
                \centering
                \includegraphics[width=0.6\textwidth]{img/Marco/AD620_Diagrama.png}
                \caption[Esquema de conexión del amplificador de instrumentación AD620.]{Esquema de conexión del amplificador de instrumentación AD620\footnotemark}
                \label{fig:AD620_pinout}
            \end{figure}
            \footnotetext{Muestra el esquema de conexión del amplificador de instrumentación AD620, con sus terminales de alimentación, entrada y salida. Imagen tomada del Datasheet del AD620. [En línea]. Disponible en: \url{https://www.analog.com/media/en/technical-documentation/data-sheets/AD620.pdf}}

            Resulta que, en el marco de operación de este amplificador de instrumentación, es posible determinar la ganancia saliente a partir de la resistencia conectada entre los pines 1 y 8 \cite{AD620_AnalogDevices}, mediante la ecuación~\ref{eq:ganancia_AD620}.

            \begin{equation}
                \label{eq:ganancia_AD620}
                G = 1 + \frac{49.4 k\Omega}{R_G}
            \end{equation}

            Donde $G$ es la ganancia del amplificador, $R_G$ es la resistencia conectada entre los pines 1 y 8 y la constante $49.4 k\Omega$ es el valor de la resistencia interna del AD620.

    \subsection{Filtros}

        Los filtros son circuitos electrónicos que permiten el paso de ciertas frecuencias de una señal eléctrica, mientras que atenúan o eliminan las frecuencias no deseadas. Los filtros se utilizan para eliminar el ruido, mejorar la calidad de la señal y extraer información relevante de una señal eléctrica. Los filtros se pueden clasificar en dos categorías principales: filtros pasivos y filtros activos.

        \subsubsection{Filtro Pasa Altas Activo de Segundo Orden Sallen-Key}

            Un filtro pasa altos activo de segundo orden \textit{Sallen-Key}\footnote{W. Laiton, «Filtro Pasa altos activo de 2do orden Sallen Key», Wilaeba Electronica, 26 de septiembre de 2018. [En línea]. Disponible en: \url{https://goo.su/5ChsR5h}} es un circuito que permite el paso de señales de alta frecuencia y atenúa las frecuencias bajas. Este filtro consta de dos resistencias y dos capacitores, y se puede configurar para diferentes aproximaciones de filtro, como Butterworth, Chebyshev y Bessel. Se conoce como activo por que tiene un elemento activo que es el amplificador operacional, es de segundo orden por que contiene dos elementos reactivos (dos capacitores), y se llama \texttt{Sallen Key} por la topología que tiene el circuito, y por el nombre de sus dos creadores R. P. Sallen y E. L. Key, ingenieros del laboratorio Lincoln del MIT. La figura~\ref{fig:Filtro_Pasa_Altas} muestra el diagrama de un filtro pasa altas de segundo orden \textit{Sallen-Key}.

            \begin{figure}[H]
                \centering
                \includegraphics[width=0.6\textwidth]{img/Marco/Filtro_Pasa_Altas.png}
                \caption[Diagrama de un filtro pasa altas de segundo orden \textit{Sallen-Key}.]{Diagrama de un filtro pasa altas de segundo orden \textit{Sallen-Key}}
                \label{fig:Filtro_Pasa_Altas}
            \end{figure}

            El valor de la frecuencia de corte $fc$, el valor del capacitor $C$ y la aproximación que se vaya a usar son libres de elección,  además de que la ganancia $A$ de este filtro debe ser igual o mayor a 1. La función de transferencia de un filtro pasa altas de segundo orden \textit{Sallen-Key} se puede calcular mediante la ecuación~\ref{eq:transferencia_pasaAltas}.

            \begin{equation}
                \label{eq:transferencia_pasaAltas}
                \frac{vo}{vi}(s) = \frac{(1 + \frac{R_b}{R_a})s^2}{s^2 + s\frac{1}{C}(\frac{2}{R_2} - \frac{R_b}{R_1R_a}) + \frac{1}{C^2R_1R_2}}
            \end{equation}

            Los valores de la constante $K$, que representa un parámetro para determinar la amplificación del filtro en la frecuencia central, y de $Q$, que corresponde al factor de calidad, para las diferentes aproximaciones del filtro se muestran en la tabla~\ref{tab:valores_filtro_pasa_altas}.
                
            \begin{table}[H]
                \centering
                \begin{tabular}{ l | c | c }
                    Aproximación & Factor de calidad $Q$ & Constante $K$ \\ \hline
                    Butterworth & 0.7071 & 1.0000 \\
                    Chebyshev (cresta de 0.01 db) & 0.7247 & 1.0231 \\
                    Chebyshev (cresta de 0.1 db) & 0.7673 & 1.0674 \\
                    Chebyshev (cresta de 0.25 db) & 0.8093 & 1.0991\\
                    Chebyshev (cresta de 0.5 db) & 0.8638 & 1.1286\\
                    Chebyshev (cresta de 1 db) & 0.9564 & 1.1596\\
                    Bessel & 0.5771 & 0.7840\\
                \end{tabular}
                \caption{Valores de $Q$ y $K$ para diferentes aproximaciones de filtro pasa altas}
                \label{tab:valores_filtro_pasa_altas}
            \end{table}

        \subsubsection{Filtro Pasa Bajas Activo de Segundo Orden Sallen-Key}

            Un filtro pasa bajas activo de segundo orden \textit{Sallen-Key}\footnote{W. Laiton, «Filtro Pasa bajas activo de 2do orden Sallen Key», Wilaeba Electronica, 24 de septiembre de 2018. [En línea]. Disponible en: \url{https://goo.su/J29uz5x}} es un circuito que permite el paso de señales de baja frecuencia y atenúa las frecuencias altas. Este filtro consta de dos resistencias y dos capacitores, y se puede configurar para diferentes aproximaciones de filtro, como Butterworth, Chebyshev y Bessel. La figura~\ref{fig:Filtro_Pasa_Bajas} muestra el diagrama de un filtro pasa bajas de segundo orden \textit{Sallen-Key}

            \begin{figure}[H]
                \centering
                \includegraphics[width=0.6\textwidth]{img/Marco/Filtro_pasa_bajas.png}
                \caption[Diagrama de un filtro pasa bajas de segundo orden \textit{Sallen-Key}.]{Diagrama de un filtro pasa bajas de segundo orden \textit{Sallen-Key}}
                \label{fig:Filtro_Pasa_Bajas}
            \end{figure}

            Los valores de la frecuencia de corte $f_c$, el capacitor $C_1$, y la aproximación que se desee utilizar son de libre elección. Además, la ganancia $A$ de este filtro debe ser igual o mayor a 1. La función de transferencia de un filtro pasa bajas de segundo orden \textit{Sallen-Key} se puede determinar utilizando la ecuación~\ref{eq:transferencia_pasaBajas}.

            \begin{equation}
                \label{eq:transferencia_pasaBajas}
                \frac{vo}{vi}(s) = \frac{(1+\frac{R_b}{R_a}) \cdot \frac{1}{C_1C_2R^2}}{s^2 + s\frac{1}{R}(\frac{2}{C_1} - \frac{R_b}{C_2R_a}) + \frac{1}{C_1C_2R^2}}
            \end{equation}

            Los valores de la constante $K$, que representa un parámetro para determinar la amplificación del filtro en la frecuencia central, y de $Q$, que corresponde al factor de calidad, para las diferentes aproximaciones del filtro se muestran en la tabla~\ref{tab:valores_filtro_pasa_bajas}.

            \begin{table}[H]
                \centering
                \begin{tabular}{ l | c | c }
                    Aproximación & Factor de calidad $Q$ & Constante $K$ \\ \hline
                    Butterworth & 0.7071 & 1.0000 \\
                    Chebyshev (cresta de 0.01 db) & 0.7247 & 0.9774 \\
                    Chebyshev (cresta de 0.1 db) & 0.7673 & 0.9368 \\
                    Chebyshev (cresta de 0.25 db) & 0.8093 & 0.9098\\
                    Chebyshev (cresta de 0.5 db) & 0.8638 & 0.8860\\
                    Chebyshev (cresta de 1 db) & 0.9564 & 0.8623\\
                    Bessel & 0.5771 & 1.2754\\
                \end{tabular}
                \caption{Valores de $Q$ y $K$ para diferentes aproximaciones de filtro pasa bajas}
                \label{tab:valores_filtro_pasa_bajas}
            \end{table}

        \subsubsection{Filtro Rechaza Banda Pasivo RC Twin-T}

            Un filtro rechaza banda (Notch) pasivo RC Twin-T\footnote{W. Laiton, «Filtro Rechaza banda Pasivo RC Twin-T», Wilaeba Electronica, 28 de septiembre de 2018. [En línea]. Disponible en: \url{https://goo.su/mTgR92}} como su nombre lo dice elimina una determinada banda de frecuencias, y permite el paso de todas las demás. Está compuesto por seis elementos, tres resistencias y tres capacitores. La figura~\ref{fig:Filtro_Rechaza_Banda} muestra el diagrama de un filtro rechaza banda pasivo RC Twin-T.

            \begin{figure}[H]
                \centering
                \includegraphics[width=0.6\textwidth]{img/Marco/Filtro_Rechaza_Banda.png}
                \caption[Diagrama de un filtro rechaza banda pasivo RC Twin-T.]{Diagrama de un filtro rechaza banda pasivo RC Twin-T}
                \label{fig:Filtro_Rechaza_Banda}
            \end{figure}

            El máximo valor del factor de calidad $Q$ para un filtro rechaza banda pasivo RC Twin-T es de 0.5. Este filtro se conoce con el nombre de filtro notch Twin-T debido que son dos redes en forma de T conectadas en paralelo.
        
    \subsection{Sensor Piezoeléctrico}
    
    El efecto piezoeléctrico es un fenómeno físico que se presenta en ciertos materiales, conocidos como materiales piezoeléctricos. Este efecto consiste en la generación de una carga eléctrica cuando se aplica una tensión mecánica a estos materiales.
    
    En términos sencillos, cuando un material piezoeléctrico es sometido a una tensión mecánica, sus átomos experimentan un ligero desplazamiento, lo que provoca una polarización eléctrica y, como resultado, se genera una diferencia de potencial eléctrico.

    En su estado normal, cuando el material no está sometido a ningún tipo de estrés externo, las cargas eléctricas dentro de las moléculas del material se distribuyen de manera uniforme. Sin embargo, cuando el material, como el cuarzo, es estirado o comprimido, la estructura atómica del cristal se altera ligeramente. Este cambio provoca que las cargas negativas se acumulen en un lado del cristal y las cargas positivas en el lado opuesto. Si se conecta un circuito entre los extremos del cristal, esta diferencia de potencial puede utilizarse para generar una corriente eléctrica. Cuanto mayor sea la compresión o tensión aplicada al cristal, mayor será la corriente eléctrica generada. A la inversa, al enviar una corriente eléctrica a través del cristal, su forma se modifica, lo que demuestra la interacción bidireccional del efecto piezoeléctrico \footnote{información tomada de \textit{NanoDays}. [En línea]. Disponible en: \url{https://goo.su/AYuZXwF}}.

    En la figura~\ref{fig:sensor_piezoelectrico} se muestra un sensor las partes que componen un sensor piezoeléctrico. Este sensor está compuesto por un cristal piezoeléctrico, un electrodo positivo y un electrodo negativo. El cristal piezoeléctrico es el material que genera la carga eléctrica cuando se aplica una tensión mecánica. Los electrodos son los conductores que permiten la conexión del sensor a un circuito eléctrico.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.6\textwidth]{img/Marco/piezoelectrico.png}
        \caption[Sensor piezoeléctrico.]{Sensor piezoeléctrico\footnotemark}
        \label{fig:sensor_piezoelectrico}
        \footnotetext{Partes de un sensor piezoeléctrico.}
        
    \end{figure}

    \subsection{Tiempo de Tránsito del Pulso}

    El tiempo de tránsito del pulso, o \textit{PTT} (por sus siglas en inglés) es el tiempo que tarda un pulso de presión arterial en viajar desde el corazón hasta un punto específico del cuerpo, como un dedo o una muñeca. Este tiempo se puede medir utilizando diferentes métodos, como la fotopletismografía (PPG) y el electrocardiograma (ECG). La relación entre el PTT y la presión arterial se basa en el principio de que a medida que aumenta la presión arterial, la velocidad de propagación del pulso también aumenta, lo que resulta en un PTT más corto. Por lo tanto, al medir el PTT y correlacionarlo con la presión arterial, es posible estimar la presión arterial sistólica y diastólica de una persona \cite{NOX_medical}.

    En la figura~\ref{fig:ptt} se muestra un ejemplo de la relación entre el tiempo de tránsito del pulso y la presión arterial. En este gráfico, se observa que se toma los picos de la onda R del ECG y la onda PPG, y se mide el tiempo que transcurre entre estos dos eventos. A medida que la presión arterial aumenta, el tiempo de tránsito del pulso disminuye, lo que indica una relación inversa entre estas dos variables.


    \begin{figure}[H]
        \centering
        \includegraphics[width=0.6\textwidth]{img/Marco/ptt.jpeg}
        \caption[Tiempo de tránsito del pulso.]{Tiempo de tránsito del pulso\footnotemark}
        \label{fig:ptt}
    \end{figure}
    \footnotetext{Ejemplo de la relación entre el tiempo de tránsito del pulso y la presión arterial. Imagen tomada del artículo \textit{Can Pulse Transit Time Be Useful for Detecting Hypertension in Patients in a Sleep Unit?} [En línea]. Disponible en: \url{https://goo.su/HaXVdrs}}

    Para estimar la presión arterial a partir del PTT, se utiliza una ecuación de regresión lineal que relaciona el PTT con la presión arterial. Esta ecuación se puede expresar de la siguiente manera \cite{Gao_2016}:

    \begin{equation}
        \label{eq:BP1}
        BP = A \cdot In(PTT) + B
    \end{equation}

    \begin{equation}
        \label{eq:BP2}
        BP = \frac{A}{PTT} + B
    \end{equation}

    Las ecuaciones \ref{eq:BP1} y \ref{eq:BP2} son ejemplos de cómo se puede modelar la relación entre el PTT y la presión arterial. En estas ecuaciones, $BP$ representa la presión arterial, $PTT$ es el tiempo de tránsito del pulso, y $A$ y $B$ son constantes que se determinan a partir de datos experimentales. La elección de la ecuación depende del modelo específico utilizado para estimar la presión arterial a partir del PTT.



\newpage
\section{Desarrollo del Proyecto}
    \subsection{Flujo de operación del sistema}
    El sistema desarrollado cosnta de varios componentes que interactúan entre sí para capturar, procesar y transmitir datos fisiológicos, permitiendo al usuario visualizar información en tiempo real y estimar la presión arterial. El flujo de operación del sistema se muestra en la figura~\ref{fig:Flujo_Operacion}.

    \begin{figure}[H]
        \centering
        \includegraphics[width=1\textwidth]{img/Desarrollo/flujo_operacion.png}
        \caption[Flujo de operación del sistema.]{Flujo de operación del sistema}
        \label{fig:Flujo_Operacion}
    \end{figure}

    En los siguientes apartados se describen las etapas del flujo de operación del sistema y el desarrollo de cada una de ellas.

    \begin{enumerate}
        \item \textbf{Captura de señales fisiológicas:}
            \begin{itemize}
                \item \textbf{Usuario:} El usuario se coloca los electrodos del ECG y el sensor PPG en los dedos correspondientes para capturar las señales fisiológicas.
                \item \textbf{Electrodos y sensor PPG:} Los electrodos del ECG y el sensor PPG capturan las señales eléctricas y ópticas del cuerpo del usuario.
            \end{itemize}
        \item \textbf{Filtrado y Acondicionamiento de señales:}
            \begin{itemize}
                \item \textbf{ECG}
                    \begin{itemize}
                        \item La señal captada por los electrodos se amplifica inicialmente mediante un amplificador de instrumentación AD620, con el fin de aumentar su amplitud.
                        \item Posteriormente, la señal pasa a través de un filtro activo pasaalto y pasa bajo de segundo orden tipo Sallen-Key, diseñado para eliminar el ruido y las frecuencias no deseadas.
                        \item A continuación, se utiliza un filtro pasabanda rechazante pasivo RC Twin-T para suprimir específicamente el ruido a 60 Hz.
                        \item Luego, la señal se amplifica nuevamente para adecuar su rango de voltaje al nivel requerido por el ADC del ESP32.
                        \item Para ajustar la señal al rango de entrada del ADC, se emplea un amplificador operacional con fuente única.
                        \item Finalmente, se incorpora un comparador con histéresis para detectar los picos de la señal.
                    \end{itemize}
                \item \textbf{PPG}
                    \begin{itemize}
                        \item La señal captada por el sensor PPG pasa a través de un filtro activo pasaalto y pasa bajo de segundo orden tipo Sallen-Key, diseñado para eliminar el ruido y las frecuencias no deseadas.
                        \item A continuación, se utiliza un filtro pasabanda rechazante pasivo RC Twin-T para suprimir específicamente el ruido a 60 Hz.
                        \item Luego, la señal se amplifica nuevamente para adecuar su rango de voltaje al nivel requerido por el ADC del ESP32.
                        \item Para ajustar la señal al rango de entrada del ADC, se emplea un amplificador operacional con fuente única.
                        \item Finalmente, se incorpora un comparador con histéresis para detectar los picos de la señal.
                    \end{itemize}
            \end{itemize}
        \item \textbf{Conversión y Procesamiento Inicial}
            \begin{itemize}
                \item \textbf{ESP32}
                    \begin{itemize}
                        \item El ESP32 recibe las señales del ECG y PPG a través de sus pines de entrada analógica.
                        \item La señal analógica se convierte a digital mediante el ADC del ESP32.
                    \end{itemize}
            \end{itemize}
        \item \textbf{Transmisión de Datos}
            \begin{itemize}
                \item \textbf{Conectividad Bluetooth}
                    \begin{itemize}
                        \item Se realiza el emparejamiento entre el ESP32 y el teléfono móvil a través de Bluetooth.
                        \item Se envian los datos fisiológicos capturados al teléfono móvil.
                    \end{itemize}
            \end{itemize}
        \item \textbf{Aplicación Android}
            \begin{itemize}
                \item \textbf{Interfaz de Usuario}
                    \begin{itemize}
                        \item Cuando el usuario abre la aplicación por primera vez, deberá iniciar sesión o registrarse.
                        \item Una vez dentro de la aplicación, el usuario puede ver sus datos fisiológicos graficados en tiempo real.
                        \item El usuario puede ver los dispositivos Bluetooth disponibles y seleccionar el ESP32 para conectarse.
                        \item La aplicación muestra el resultado de la estimación de la presión arterial y la frecuencia cardíaca.
                    \end{itemize}
            \end{itemize}
        \item \textbf{Visualización y Análisis en la Aplicación Android}
            \begin{itemize}
                \item \textbf{Recepción de Datos}
                    \begin{itemize}
                        \item La aplicación recibe los datos fisiológicos del ESP32 a través de Bluetooth y los procesa para su visualización.
                        \item Los datos recibidos incluyen la señal del ECG, la señal del PPG y los picos de ambas señales.
                    \end{itemize}
                \item \textbf{Estimación de la Presión Arterial}
                    \begin{itemize}
                        \item La aplicación realiza un preprocesamiento para calcular el \textit{Pulse Transit Time (PTT)} utilizando la señal del ECG y del PPG.
                        \item A partir del \textit{PTT}, la aplicación estima la presión arterial sistólica y diastólica del usuario.
                        \item Se obtiene la frecuencia cardíaca a partir de la señal del PPG.
                    \end{itemize}
            \end{itemize}
        \item \textbf{Almacenamiento de Datos}
            \begin{itemize}
                \item \textbf{Base de Datos}
                    \begin{itemize}
                        \item La aplicación almacena los datos fisiológicos del usuario en Firebase.
                        \item Los datos almacenados incluyen la fecha y hora de la captura, la frecuencia cardíaca, la presión arterial sistólica y diastólica.
                        \item El usuario puede acceder a su historial de datos a través de la aplicación.
                    \end{itemize}
            \end{itemize}
    \end{enumerate}

    En la figura~\ref{fig:Diagrama_Secuencia} se muestra el diagrama de secuencia del sistema, que ilustra la interacción entre los componentes del sistema durante la captura, procesamiento y transmisión de datos fisiológicos.

    \begin{figure}[H]
        \centering
        \includegraphics[width=1\textwidth]{img/Desarrollo/diagrama_secuencia.png}
        \caption{Diagrama de secuencia del sistema}
        \label{fig:Diagrama_Secuencia}
    \end{figure}

    \subsection{Desarrollo del circuito de ECG}
        \subsubsection{Amplificador de Instrumentación AD620}
        Para el desarrollo del sistema, comenzamos con el diseño del circuito de ECG utilizando un amplificador de instrumentación AD620, encargado de amplificar la señal captada por los electrodos del ECG. Mediante métodos de prueba y error, se determinó que una ganancia de 21 era necesaria para obtener una señal de salida adecuada.

        Con la ganancia deseada establecida, procedimos a calcular el valor de la resistencia $R_G$, la cual se conecta entre los pines 1 y 8 del AD620. Para ello, partimos de la ecuación~\ref{eq:ganancia_AD620}, que describe la relación entre la ganancia y la resistencia, y la despejamos para obtener la ecuación~\ref{eq:resistencia}, que nos permitió calcular el valor óptimo de $R_G$.

        \begin{equation}
            \label{eq:resistencia}
            R_G = \frac{49.4 k\Omega}{G - 1} = \frac{49.4 k\Omega}{21 - 1} = 2470 \Omega \approx 2.5 k\Omega
        \end{equation}

        Con la resistencia calculada, se procedió a diseñar el circuito en el software de diseño de circuitos Multisim, obteniendo una ganancia de 20.76, muy cercana a la deseada. La figura~\ref{fig:Simulacion_AD620} muestra la simulación del amplificador de instrumentación AD620 en Multisim.

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{img/Desarrollo/multisim_AD620AN.png}
            \caption[Simulación del amplificador de instrumentación AD620.]{Simulación del amplificador de instrumentación AD620\footnotemark}
            \label{fig:Simulacion_AD620}
        \end{figure}
        \footnotetext{Muestra la simulación del amplificador de instrumentación AD620 en el software Multisim, con una ganancia de 20.76.}

        \subsubsection{Filtro Activo Pasa Altas}
        Para eliminar el ruido de baja frecuencia presente en la señal de ECG, se implementó un filtro pasa altas de segundo orden tipo \textit{Sallen-Key}. Este filtro permite el paso de frecuencias superiores a una frecuencia de corte, mientras atenúa las frecuencias inferiores a esta.

        En el diseño de este filtro, se utilizó una aproximación de Butterworth debido a su respuesta de frecuencia más plana en la banda de paso, lo que implica la ausencia de sobrepicos en dicha banda y una caída más gradual en la banda de rechazo. Esto contrasta con la aproximación de Chebyshev, que presenta sobrepicos en la banda de paso y una caída más abrupta en la banda de rechazo, o con la aproximación de Bessel,que  ofrece una fase lineal. Los valores de $Q$ y $K$ se obtuvieron de la Tabla~\ref{tab:valores_filtro_pasa_altas}, que presenta los parámetros correspondientes a dicha aproximación.

        \paragraph{Ganancia del Amplificador Operacional}
        Dado que la señal ya fue amplificada en la etapa anterior, se decidió establecer una ganancia unitaria. Por lo tanto, se estableció $R_a$ como infinito (circuito abierto) y $R_b$ como cero (corto circuito), resultando en la Ecuación~\ref{eq:funcion_amplificador_operacional_pasa_altos} para la ganancia del amplificador operacional.

        \begin{equation}
            \label{eq:funcion_amplificador_operacional_pasa_altos}
            A = 1 + \frac{R_b}{R_a} = 1
        \end{equation}

        \paragraph{Cálculo de factor m}
        El factor $m$ es crucial para determinar las resistencias del filtro pasa altos. Se calcula mediante la Ecuación~\ref{eq:factor_m_pasa_altos}.

        \begin{equation}
            \label{eq:factor_m_pasa_altos}
            m = \frac{1+\sqrt{1+8Q^2(A-1)}}{4Q}
        \end{equation}

        Donde:
        \begin{itemize}
            \item $A$: Ganancia del amplificador operacional.
            \item $Q$: Factor de calidad del filtro.
        \end{itemize}

        Para un filtro Butterworth de segundo orden, que ofrece una respuesta en frecuencia plana en la banda de paso, el factor de calidad $Q$ es igual 0.7071. Sustituyendo los valores de $A = 1$ de la Ecuación~\ref{eq:funcion_amplificador_operacional_pasa_altos} y $Q = 0.7071$ en la Ecuación~\ref{eq:factor_m_pasa_altos}, se obtiene el valor de $m$.

        \begin{equation}
            \label{eq:factor_m_pasa_altos_valor}
            m = \frac{1+\sqrt{1+8(0.7071)^2(1-1)}}{4(0.7071)} = \frac{1 + \sqrt{1}}{2.8284}\approx 0.7071
        \end{equation}

        \paragraph{Frecuencia de corte}
        La frecuencia de corte $f_c$ el cual es el punto en el que la señal de salida se atenúa en $-3 dB$, se calcula mediante la Ecuación~\ref{eq:frecuencia_corte_pasa_altos}.
        \begin{equation}
            \label{eq:frecuencia_corte_pasa_altos}
            f_c = \frac{m}{2\pi \cdot k \cdot R_1 \cdot C}
        \end{equation}

        Donde:

        \begin{itemize}
            \item $k$: Constante de la aproximación del filtro.
            \item $R_1$: Resistencia seleccionada.
            \item $C$: Capacitor seleccionada.
        \end{itemize}

        Seleccionamos un valor de $R_1 = 2.2 k\Omega$ y $C = 3.3 \mu F$. Además de que la constante $k$ para una aproximación de Butterworth es 1. Sustituyendo estos valores en la Ecuación~\ref{eq:frecuencia_corte_pasa_altos}, se obtiene la frecuencia de corte del filtro pasa altos.

        \begin{equation}
            \label{eq:frecuencia_corte_pasa_altos_valor}
            f_c = \frac{0.7071}{2\pi \cdot 1 \cdot 2.2 k\Omega \cdot 3.3 \mu F} \approx 15.5 Hz
        \end{equation}

        Esta frecuencia de corte es adecuada para eliminar el ruido de baja frecuencia presente en la señal de ECG.

        \paragraph{Selección de resistencias $R_2$}
        La resistencia $R_2$ se calcula mediante la ecuación~\ref{eq:resistencia_R2_pasa_altos}.

        \begin{equation}
            \label{eq:resistencia_R2_pasa_altos}
            R_2 = \frac{R_1}{m^2} = \frac{2.2 k\Omega}{(0.7071)^2} \approx 4.4 k\Omega 
        \end{equation}

        Se llevó a cabo el diseño del filtro paso alto de segundo orden tipo \textit{Sallen-Key} en Multisim. La Figura~\ref{fig:Simulacion_Filtro_Pasa_Altas} presenta la simulación del filtro en Multisim, utilizando las resistencias y el capacitor seleccionados.

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{img/Desarrollo/multisim_pasaAltos.png}
            \caption[Simulación del filtro pasa altas de segundo orden \textit{Sallen-Key}.]{Simulación del filtro pasa altas de segundo orden \textit{Sallen-Key}\footnotemark}
            \label{fig:Simulacion_Filtro_Pasa_Altas}
        \end{figure}
        \footnotetext{Muestra la simulación del filtro pasa altas de segundo orden \textit{Sallen-Key} en el software Multisim, con una frecuencia de corte de 15.5 Hz.}

        \subsubsection{Filtro Activo Pasa Bajos.}
        Para eliminar el ruido de alta frecuencia presente en la señal de ECG, se implementó un filtro pasa bajas de segundo orden tipo \textit{Sallen-Key}. Este filtro permite el paso de frecuencias inferiores a una frecuencia de corte, mientras atenúa las frecuencias superiores a esta.

        En el diseño de este filtro, se utilizó una aproximación de Butterworth y los valores de $Q$ y $K$ se obtuvieron de la Tabla~\ref{tab:valores_filtro_pasa_bajas}, que presenta los parámetros correspondientes a dicha aproximación.

        \paragraph{Ganancia del Amplificador Operacional}
        En este diseño, al igual que con el filtro pasa altas, se busca mantener una ganancia unitaria para evitar amplificar la señal y minimizar la introducción de ruido.
        Esto configura el amplificador operacional como un seguidor de voltaje conectando su salida directamente a la entrada inversora, lo que elimina las resistencias $R_a$ y $R_b$, simplificando la ganancia del amplificador operacional a la ecuación~\ref{eq:funcion_amplificador_operacional_pasa_bajos}.

        \begin{equation}
            \label{eq:funcion_amplificador_operacional_pasa_bajos}
            A = 1 + \frac{R_b}{R_a} = 1
        \end{equation}

        \paragraph{Cálculo de factor m}
        El factor $m$ es crucial para determinar las capacitancias del filtro pasa bajas. Se calcula mediante la ecuación~\ref{eq:factor_m_pasa_bajos}.

        \begin{equation}
            \label{eq:factor_m_pasa_bajos}
            m = \frac{1+\sqrt{1+8Q^2(A-1)}}{4Q}
        \end{equation}

        Donde:

        \begin{itemize}
            \item $A$: Ganancia del amplificador operacional.
            \item $Q$: Factor de calidad del filtro.
        \end{itemize}

        Para un filtro Butterworth de segundo orden, que ofrece una respuesta en frecuencia plana en la banda de paso, el factor de calidad $Q$ es igual 0.7071. Sustituyendo los valores de $A = 1$ y $Q = 0.7071$ en la ecuación~\ref{eq:factor_m_pasa_bajos}, se obtiene el valor de $m$.

        \begin{equation}
            \label{eq:factor_m_pasa_bajos_valor}
            m = \frac{1+\sqrt{1+8(0.7071)^2(1-1)}}{4(0.7071)} = \frac{1 + \sqrt{1}}{2.8284}\approx 0.7071
        \end{equation}

        \paragraph{Frecuencia de corte}
        La frecuencia de corte $f_c$ el cual es el punto en el que la señal de salida se atenúa en $-3 dB$, se calcula mediante la ecuación~\ref{eq:frecuencia_corte_pasa_bajos}.

        \begin{equation}
            \label{eq:frecuencia_corte_pasa_bajos}
            f_c = \frac{1}{2\pi \cdot k \cdot R \cdot m \cdot C_1}
        \end{equation}

        Donde:
        \begin{itemize}
            \item $k$: Constante de la aproximación del filtro.
            \item $R$: Resistencia seleccionada.
            \item $C_1$: Capacitancia seleccionada.
        \end{itemize}

        Seleccionamos un valor de $R = 2.7 k\Omega$ y $C_1 = 4.7 \mu F$. Además de que la constante $k$ para una aproximación de Butterworth es 1. Sustituyendo estos valores en la ecuación~\ref{eq:frecuencia_corte_pasa_bajos}, se obtiene la frecuencia de corte del filtro pasa bajos.

        \begin{equation}
            \label{eq:frecuencia_corte_pasa_bajos_valor}
            f_c = \frac{1}{2\pi \cdot 1 \cdot 2.7 k\Omega \cdot 0.7071\cdot 4.7 \mu F} = \frac{1}{2\pi \cdot 2.7 x10^3 \cdot 0.7071\cdot 4.7 x10^{-6}} \approx 17.737 Hz
        \end{equation}

        Esta frecuencia de corte es adecuada para eliminar el ruido de alta frecuencia presente en la señal de ECG.

        \paragraph{Cálculo de la capacitancia C2}
        La capacitancia $C_2$ se calcula mediante la ecuación~\ref{eq:capacitancia_C2_pasa_bajos}.

        \begin{equation}
            \label{eq:capacitancia_C2_pasa_bajos}
            C_2 = m^2 \cdot C_1 = (0.7071)^2 \cdot 4.7 \mu F \approx 2.35 \mu F
        \end{equation}

        Se seleccionó un valor de $C_2 = 2.2 \mu F$, ya que es el valor comercial más cercano al calculado.

        \begin{equation}
            C_2 = 2.2 \mu F
        \end{equation}

        Se llevó a cabo el diseño del filtro pasa bajas de segundo orden tipo \textit{Sallen-Key} en Multisim. La Figura~\ref{fig:Simulacion_Filtro_Pasa_Bajas} presenta la simulación del filtro en Multisim, utilizando las resistencias y los capacitores seleccionados.

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{img/Desarrollo/multisim_pasaBajos.png}
            \caption[Simulación del filtro pasa bajas de segundo orden \textit{Sallen-Key}.]{Simulación del filtro pasa bajas de segundo orden \textit{Sallen-Key}\footnotemark}
            \label{fig:Simulacion_Filtro_Pasa_Bajas}
        \end{figure}
        \footnotetext{Muestra la simulación del filtro pasa bajas de segundo orden \textit{Sallen-Key} en el software Multisim, con una frecuencia de corte de 17.737 Hz.}
            
        \subsubsection{Filtro Notch Pasivo Rechaza Banda RC Twin-T}
        En la etapa de acondicionamiento de la señal, se implementó un filtro notch pasivo RC tipo Twin-T para atenuar las interferencias de 60 Hz, comúnmente presentes debido al ruido de la red eléctrica. Este filtro es eficaz para eliminar una frecuencia específica sin afectar significativamente las demás componentes de la señal.

        El filtro Twin-T es un circuito pasivo que utiliza resistencias y capacitores dispuestos en una configuración en forma de ``T'' doble, lo que permite rechazar una frecuencia central $f_0$. Al ser un filtro pasivo, está compuesto únicamente por resistencias y capacitores, lo que simplifica su diseño y construcción. Sin embargo, su factor de calidad $Q$ es limitado, generalmente por debajo de 0.5, lo que implica un ancho de banda relativamente amplio en comparación con filtros activos. En otras palabras, si tenemos una frecuencia central de 100 Hz, el ancho de banda del filtro será de 200 Hz.

        Para diseñar el filtro notch pasivo RC Twin-T centrado en $f_0 = 60 Hz$, se utilizaron las siguientes ecuaciones:

        Seleccionamos los parámetros iniciales del filtro:
        \begin{itemize}
            \item Frecuencia central $(f_0) = 60 Hz$
            \item Factor de calidad $(Q) = 0.25$
            \item Capacitancia base $(C_1) = 100 nF$
        \end{itemize}

        \paragraph{Cálculo de la resistencia R1}
        La resistencia $R_1$ se calcula mediante la ecuación~\ref{eq:resistencia_R1_notch}.

        \begin{equation}
            \label{eq:resistencia_R1_notch}
            R_1 = \frac{1}{4\pi \cdot f_0 \cdot Q \cdot C_1}
        \end{equation}

        Sustituyendo los valores de $f_0 = 60 Hz$, $Q = 0.25$ y $C_1 = 100 nF$ en la ecuación~\ref{eq:resistencia_R1_notch}, se obtiene el valor de $R_1$.

        \begin{equation}
            R_1 = \frac{1}{4\pi \cdot 60 Hz \cdot 0.25 \cdot 100 nF} = 53051.6477 \Omega \approx 53 k\Omega
        \end{equation}

        \paragraph{Cálculo de la resistencia R2}
        La resistencia $R_2$ se calcula mediante la ecuación~\ref{eq:resistencia_R2_notch}.

        \begin{equation}
            \label{eq:resistencia_R2_notch}
            R_2 = \frac{1}{2\pi \cdot f_0 (1 - 2Q) \cdot C_1}
        \end{equation}

        Sustituyendo los valores en la ecuación~\ref{eq:resistencia_R2_notch}, se obtiene el valor de $R_2$.

        \begin{equation}
            R_2 = \frac{1}{2\pi \cdot 60 Hz(1 - 2(0.25)) \cdot 100 nF} = 53051.6477 \Omega \approx 53 k\Omega
        \end{equation}

        \paragraph{Cálculo de la resistencia R3}
        La resistencia $R_3$ se calcula mediante la ecuación~\ref{eq:resistencia_R3_notch}.

        \begin{equation}
            \label{eq:resistencia_R3_notch}
            R_3 = \frac{1}{2\pi \cdot f_0 \cdot C_1}
        \end{equation}

        Sustituyendo los valores en la ecuación~\ref{eq:resistencia_R3_notch}, se obtiene el valor de $R_3$.

        \begin{equation}
            R_3 = \frac{1}{2\pi \cdot 60 Hz \cdot 100 nF} = 26525.824 \Omega \approx 26.5 k\Omega
        \end{equation}

        \paragraph{Cálculo de la capacitancia C2}
        La capacitancia $C_2$ se calcula mediante la ecuación~\ref{eq:capacitancia_C2_notch}.

        \begin{equation}
            \label{eq:capacitancia_C2_notch}
            C_2 = 2Q \cdot C_1
        \end{equation}

        Sustituyendo el valor de $C_1 = 100 nF$ en la ecuación~\ref{eq:capacitancia_C2_notch}, se obtiene el valor de $C_2$.

        \begin{equation}
            C_2 = 2(0.25) \cdot 100 nF = 50 nF
        \end{equation}

        \paragraph{Cálculo de la capacitancia C3}
        La capacitancia $C_3$ se calcula mediante la ecuación~\ref{eq:capacitancia_C3_notch}.

        \begin{equation}
            \label{eq:capacitancia_C3_notch}
            C_3 = (1 - 2Q) \cdot C_1
        \end{equation}

        Sustituyendo los valores, tenemos que:

        \begin{equation}
            C_3 = (1 - 2(0.25)) \cdot 100 nF = 50 nF
        \end{equation}

        Con los valores de resistencias y capacitancias calculados, se llevó a cabo el diseño del filtro pasabanda rechazante pasivo RC Twin-T en Multisim. La figura~\ref{fig:Simulacion_Filtro_Rechaza_Banda} presenta la simulación del filtro en Multisim, utilizando las resistencias y los capacitores seleccionados.

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{img/Desarrollo/multisim_rechazaBandas.png}
            \caption[Simulación del filtro rechaza banda pasivo RC Twin-T.]{Simulación del filtro rechaza banda pasivo RC Twin-T\footnotemark}
            \label{fig:Simulacion_Filtro_Rechaza_Banda}
        \end{figure}
        \footnotetext{Muestra el diseño del filtro rechaza banda pasivo RC Twin-T en el software Multisim, centrado en 60 Hz.}

        \subsubsection{Amplificador no Inversor}
        Para visualizar la señal de mejor manera, es necesario amplificar nuevamente la señal ya acondicionada antes de su observación en el osciloscopio. Para ello, un amplificador no inversor sencillo es adecuado para cumplir con esta tarea. A continuación se muestra la ecuación~\ref{eq:ganancia_amplificador_no_inversor} para calcular la ganancia del amplificador no inversor.

        \begin{equation}
            \label{eq:ganancia_amplificador_no_inversor}
            A = 1 + \frac{R_F}{R_{1}} = 1 + \frac{1 M\Omega}{10 k\Omega} = 101
        \end{equation}

        Donde $R_1$ es la resistencia de realimentación y $R_g$ es la resistencia de ganancia. Este diseño amplifica la señal de ECG en un factor de 101, lo 
        que permite observar la señal en el osciloscopio.
        Se llevó a cabo el diseño del amplificador no inversor en Multisim. La figura~\ref{fig:Simulacion_Amplificador_No_Inversor} presenta la simulación del amplificador no inversor en Multisim, utilizando las resistencias seleccionadas.

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.4\textwidth]{img/Desarrollo/multisim_AmpNoInversor.png}
            \caption[Simulación del amplificador no inversor.]{Simulación del amplificador no inversor\footnotemark}
            \label{fig:Simulacion_Amplificador_No_Inversor}
        \end{figure}
        \footnotetext{Muestra la simulación del amplificador no inversor en el software Multisim.}

        \subsubsection{Amplificador operacional con fuente única}
        Una vez obtenida la señal filtrada y amplificada, es necesario establecer un nivel de referencia adecuado para la señal. Para ello, se utiliza un amplificador operacional con fuente única, que permite ajustar el nivel de referencia de modo que la señal de salida oscile entre $0\,V$ y $3.3\,V$, rango compatible con la entrada ADC del ESP32.

        Para generar este nivel de referencia, se emplea un divisor de voltaje formado por dos resistencias, $R_a = 56\,k\Omega$ y $R_b = 27\,k\Omega$, conectadas a la entrada no inversora del amplificador operacional. El voltaje resultante se calcula mediante la ecuación~\ref{eq:divisor_de_voltaje}:

        \begin{equation}
            \label{eq:divisor_de_voltaje}
            V_{out} = \frac{R_b}{R_a + R_b} \cdot V_{in}
        \end{equation}

        donde $V_{in}$ es el voltaje de alimentación del amplificador operacional, que en este caso es $5\,V$. Por lo tanto, el voltaje de referencia obtenido es:

        \begin{equation}
            \label{eq:voltaje_divisorECG}
            V_{out} = \frac{27\,k\Omega}{56\,k\Omega + 27\,k\Omega} \cdot 5\,V = 1.62\,V
        \end{equation}

        Este voltaje de referencia se suma a la señal acondicionada del ECG, permitiendo que la señal resultante oscile dentro del rango de $0\,V$ a $3.3\,V$, que es el rango máximo soportado por el ADC del ESP32. De esta manera, se evita la saturación o pérdida de información en la adquisición de la señal.

        Adicionalmente, se incorpora un filtro pasa altas RC de primer orden en la entrada inversora del amplificador operacional para eliminar componentes de corriente continua (0 Hz). Esto se logra mediante un capacitor $C_1$ en serie con una resistencia $R_1 = 10\,k\Omega$, conectados a dicha entrada. El capacitor actúa como un circuito abierto para señales de corriente continua, bloqueándolas efectivamente.

        El valor del capacitor se calcula con la ecuación~\ref{eq:frecuencia_corte_filtro_RC}, correspondiente a la frecuencia de corte de un filtro RC pasa altas:

        \begin{equation}
            \label{eq:frecuencia_corte_filtro_RC}
            f_c = \frac{1}{2\pi R_1 C}
        \end{equation}

        Donde $f_c$ es la frecuencia de corte, $R$ es la resistencia y $C$ es el capacitor. Para el filtro pasa altas, se desea una frecuencia de corte de 0.5\,Hz, por lo que se despeja la ecuación~\ref{eq:frecuencia_corte_filtro_RC} para obtener el valor del capacitor:

        \begin{equation}
            \label{eq:valor_capacitor}
            C = \frac{1}{2\pi R_1 f_c} = \frac{1}{2\pi (10\,k\Omega)(0.5\,Hz)} = 31.8\,\mu F
        \end{equation}

        Se selecciona un capacitor comercial de $33\,\mu F$, que es el valor más cercano al calculado.

        Para calcular la ganancia del amplificador operacional, se utiliza la ecuación~\ref{eq:amplitud_filtro_RC_ECG}, que relaciona la ganancia $A$ con las resistencias $R_1$ y $R_2$:

        \begin{equation}
            \label{eq:amplitud_filtro_RC_ECG}
            A = \frac{R_2}{R_1}
        \end{equation}

        Deseamos amplificar la señal de entrada 10 veces, por lo que con un valor de $R_1 = 10\,k\Omega$, despejamos la ecuación~\ref{eq:amplitud_filtro_RC_ECG} para obtener $R_2$:

        \begin{equation}
            \label{eq:valor_R2}
            R_2 = A \cdot R_1 = 10 \times 10\,k\Omega = 100\,k\Omega
        \end{equation}

        El diseño del amplificador operacional con fuente única se simuló en Multisim utilizando los valores seleccionados para las resistencias y el capacitor. La figura~\ref{fig:Simulacion_Amplificador_Con_Fuente_Unica} muestra la simulación obtenida en Multisim.


        \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{img/Desarrollo/multisim_ampFuenteUnica.png}
            \caption[Simulación del amplificador operacional con fuente única.]{Simulación del amplificador operacional con fuente única\footnotemark}
            \label{fig:Simulacion_Amplificador_Con_Fuente_Unica}
        \end{figure}
        \footnotetext{Muestra la simulación del amplificador operacional con fuente única en el software Multisim.}

        \subsubsection{Histéresis de la señal de ECG}
        La histéresis es un fenómeno que se presenta en los sistemas eléctricos y electrónicos, donde la salida de un sistema depende no solo de su entrada actual, sino también de su historia pasada. En el caso del ECG, la histéresis puede ayudar a detectar los picos de la señal de manera más precisa, evitando falsas detecciones causadas por ruidos o interferencias. Para implementar la histéresis en el circuito, se utiliza un comparador de voltaje, usando una resistencia y un potenciómetro que se encargarán de ajustar el voltaje de referencia. Para ello seleccionamos un potenciómetro de 10k$\Omega$ y una resistencia de 1k$\Omega$. Lo que nos da un voltaje de referencia que se calcula mediante la ecuación~\ref{eq:divisor_de_voltaje_histeresis}.

        \begin{equation}
            \label{eq:divisor_de_voltaje_histeresis}
            V_{out} = \frac{R_b}{R_a + R_b} \cdot V_{in}
        \end{equation}

        Donde $V_{in}$ es la tensión de alimentación del comparador, que en este caso es de 5V. Por lo tanto, el voltaje de salida se calcula como:
        
        \begin{equation}
            \label{eq:voltaje_divisor_histeresis}
            V_{out} = \frac{10k\Omega}{1k\Omega + 10k\Omega} \cdot 5V = 4.55V
        \end{equation}

        Este valor será el voltaje de referencia máxima.
        Ahora para el voltaje de referencia mínima, se utiliza la resistencia de 1k$\Omega$ y el potenciómetro ajustado a 1$\Omega$, realizando el mismo procedimiento que en la ecuación~\ref{eq:divisor_de_voltaje_histeresis}.
        \begin{equation}
            \label{eq:voltaje_divisor_histeresis_minimo}
            V_{out} = \frac{1k\Omega}{1k\Omega + 10k\Omega} \cdot 5V = 0.45V
        \end{equation}
        Este voltaje de referencia mínimo se utiliza para establecer un umbral inferior en la señal de ECG, lo que ayuda a evitar la detección de picos inferiores.
        Ya teniendo el voltaje máximo y mínimo, podremos ajustar con el potenciómetro de 0.45V a 4.55V, lo cual es suficiente para detectar los picos de la señal de ECG, y solo muestre una señal binaria.
        El circuito del histéresis se muestra en la siguiente figura~\ref{fig:Simulacion_Histeresis}.

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{img/Desarrollo/multisim_histeresis.png}
            \caption[Simulación del circuito de histéresis.]{Simulación del circuito de histéresis\footnotemark}
            \label{fig:Simulacion_Histeresis}
        \end{figure}
        \footnotetext{Muestra la simulación del circuito de histéresis en el software Multisim.}
        
        \subsubsection{Simulación del Circuito de ECG}

        Finalmente, se procedió a simular el circuito completo de ECG en Multisim, incluyendo el amplificador de instrumentación AD620, los filtros activos pasa altas y pasa bajas de segundo orden tipo \textit{Sallen-Key}, el filtro notch pasivo RC Twin-T, el amplificador no inversor, el amplificador con fuente única y la histéresis de la señal. La Figura~\ref{fig:Simulacion_circuito_ECG} muestra el circuito completo simulado en Multisim.

        \begin{figure}[H]
            \centering
            \includegraphics[width=1.0\textwidth]{img/Desarrollo/multisim_circuito.png}
            \caption[Simulación del circuito de ECG en Multisim.]{Simulación del circuito de ECG en Multisim\footnotemark}
            \label{fig:Simulacion_circuito_ECG}
        \end{figure}
        \footnotetext{Muestra el circuito de ECG completo simulado en el software Multisim.}

        En la Figura~\ref{fig:Simulacion_senial_ECG} se muestra la señal simulada del ECG acondicionada en el osciloscopio, la cual se visualiza de forma clara y precisa, lista para ser transmitida al ESP32 para su procesamiento y análisis.

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.7\textwidth]{img/Desarrollo/multisim_simulacion.png}
            \caption[Señal de ECG acondicionada.]{Señal de ECG acondicionada\footnotemark}
            \label{fig:Simulacion_senial_ECG}
        \end{figure}
        \footnotetext{Muestra la señal de ECG acondicionada en el osciloscopio.}

    \subsection{Desarrollo de las pinzas para los piezoeléctricos}

    Para la captura de las señales del ECG, se diseñaron pinzas que permiten colocar los piezoeléctricos en los dedos del usuario. Estas pinzas fueron impresas en 3D, con un diseño orientado a la comodidad y facilidad de uso. Están compuestas por dos partes: una inferior, que sostiene el piezoeléctrico y se ajusta al dedo del usuario, y una superior, que se acopla a la parte inferior para ejercer presión sobre el piezoeléctrico. Las Figuras~\ref{fig:Pinza_Inferior} y~\ref{fig:Pinza_Superior} muestran las pinzas diseñadas para el sensor ECG.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.5\textwidth]{img/Desarrollo/pinza_Inferior.png}
        \caption{Pinza inferior para el sensor ECG}
        \label{fig:Pinza_Inferior}
    \end{figure}

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.5\textwidth]{img/Desarrollo/pinza_superior.png}
        \caption{Pinza superior para el sensor ECG}
        \label{fig:Pinza_Superior}
    \end{figure}

    La Figura~\ref{fig:Pinzas_ECG} muestra el modelo final de las pinzas para el sensor de ECG, las cuales se imprimieron en 3D y se utilizaron para capturar las señales fisiológicas del usuario.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.4\textwidth]{img/Desarrollo/pinzas_electrocardiograma.png}
        \caption{Pinzas para el sensor de ECG}
        \label{fig:Pinzas_ECG}
    \end{figure}

    \subsection{Visualización de las señales en el osciloscopio}
        \subsubsection{Visualización de la señal de ECG en el osciloscopio}

        En la Figura~\ref{fig:ECG_Osciloscopio} se muestra la señal de ECG acondicionada tal como se visualiza en el osciloscopio. La señal aparece clara y precisa, lista para ser transmitida al ESP32 para su procesamiento y análisis.

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{img/Desarrollo/electro_osciloscopio.png}
            \caption{Señal de ECG acondicionada.}
            \label{fig:ECG_Osciloscopio}
        \end{figure}
        \footnotetext{Muestra la señal de ECG acondicionada en el osciloscopio.}

        \subsubsection{Visualización de la histéresis en la señal de ECG}

        En la Figura~\ref{fig:ECG_Osciloscopio_Histeresis} se presenta la señal binaria de histéresis correspondiente a la señal de ECG acondicionada, capturada en el osciloscopio. La histéresis se activa cuando la señal de ECG supera un umbral específico, permitiendo detectar los picos de la señal con mayor precisión y evitando falsas detecciones ocasionadas por ruido o interferencias.

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{img/Desarrollo/histerisisECG.png}
            \caption[Señal de histéresis de ECG.]{Señal binaria de histéresis de ECG.\footnotemark}
            \label{fig:ECG_Osciloscopio_Histeresis}
        \end{figure}
        \footnotetext{Señal binaria de histéresis de ECG.}

        \subsubsection{Visualización de los picos en la señal de ECG}

        En la Figura~\ref{fig:ECGconHisteresis} se muestra la señal de ECG acondicionada junto con la señal de histéresis aplicada, ambas visualizadas en el osciloscopio. La señal de salida del comparador se presenta como una señal binaria, donde los picos de la señal de ECG se representan mediante pulsos altos. 

        Esta técnica facilita el cálculo del PTT (\textit{Pulse Transit Time}), al permitir una detección más precisa de los picos de la señal. La histéresis contribuye a evitar falsas detecciones ocasionadas por ruido o interferencias, mejorando así la calidad de la señal y la exactitud en el análisis posterior.

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{img/Desarrollo/electro_histeresis.png}
            \caption[Señal de electrocardiograma con histéresis.]{Señal de electrocardiograma con histéresis.\footnotemark}
            \label{fig:ECGconHisteresis}
        \end{figure}
        \footnotetext{Señal de electrocardiograma con histéresis visualizada en el osciloscopio.}

    \subsection{Desarrollo del filtros para el sensor PPG}
    El sensor de fotopletismografía (PPG) es un método no invasivo para medir la frecuencia cardíaca y la saturación de oxígeno en la sangre. Debido a que su salida es una señal analógica susceptible a ruido eléctrico y artefactos de movimiento, es necesario incorporar filtros. Para ello, se implementaron filtros activos de segundo orden tipo \textit{Sallen-Key} para eliminar, respectivamente, el ruido de alta y baja frecuencia, junto con un filtro rechaza banda destinado a suprimir la interferencia de 60 Hz. Además, se utilizó un amplificador offset para ajustar el nivel de referencia de la señal y una histéresis para mejorar la detección de picos inferiores.

        \subsubsection{Filtro Activo Pasa Bajas}
        Para el sensor PPG, se implementó un filtro pasa bajas de segundo orden tipo \textit{Sallen-Key}
        para eliminar el ruido de alta frecuencia presente en la señal. Este filtro permite el paso de frecuencias inferiores a una frecuencia de corte, mientras atenúa las frecuencias superiores a esta.

        En el diseño de este filtro, se utilizó una aproximación de Butterworth y los valores de $Q$ y $K$ se obtuvieron de la Tabla~\ref{tab:valores_filtro_pasa_bajas}, que presenta los parámetros correspondientes a dicha aproximación.

        \paragraph{Ganancia del Amplificador Operacional}
        En este diseño, al igual que con el filtro pasa bajas del ECG, se busca mantener una ganancia unitaria para evitar amplificar la señal y minimizar la introducción de ruido. Esto configura el amplificador operacional como un seguidor de voltaje conectando su salida directamente a la entrada inversora, lo que elimina las resistencias $RA$ y $RB$, simplificando la ganancia del amplificador operacional a la ecuación~\ref{eq:funcion_amplificador_operacional_pasa_bajos_ppg}.

        \begin{equation}
            \label{eq:funcion_amplificador_operacional_pasa_bajos_ppg}
            A = 1 + \frac{R_b}{R_a} = 1
        \end{equation}

        \paragraph{Cálculo de factor m}
        El factor $m$ es crucial para determinar las capacitancias del filtro pasa bajas. Se calcula mediante la ecuación~\ref{eq:factor_m_pasa_bajos_ppg}.

        \begin{equation}
            \label{eq:factor_m_pasa_bajos_ppg}
            m = \frac{1+\sqrt{1+8Q^2(A-1)}}{4Q}
        \end{equation}

        Donde:

        \begin{itemize}
            \item $A$: Ganancia del amplificador operacional.
            \item $Q$: Factor de calidad del filtro.
        \end{itemize}

        Para un filtro Butterworth de segundo orden, que ofrece una respuesta en frecuencia plana en la banda de paso, el factor de calidad $Q$ es igual $0.7071$. Sustituyendo los valores de $A = 1$ y $Q = 0.7071$ en la ecuación~\ref{eq:factor_m_pasa_bajos_ppg}, se obtiene el valor de $m$.

        \begin{equation}
            \label{eq:factor_m_pasa_bajos_ppg_valor}
            m = \frac{1+\sqrt{1+8(0.7071)^2(1-1)}}{4(0.7071)} = \frac{1 + \sqrt{1}}{2.8284}\approx 0.7071
        \end{equation}

        \paragraph{Frecuencia de corte}
        El ruido eléctrico, interferencias electromagnéticas y artefactos de movimiento pueden introducir frecuencias más altas. Por lo tanto, se seleccionó una frecuencia de corte de $10 Hz$ para eliminar el ruido de alta frecuencia presente en la señal de PPG.

        \paragraph{Cálculo de la resistencia R}
        Para obtener el valor de la resistencia $R$, necesitamos escoger un valor para la capacitancia $C_1$. Se seleccionó un valor de $C_1 = 1 \mu F$. La resistencia $R$ se calcula mediante la ecuación~\ref{eq:resistencia_R_pasa_bajas_ppg}.

        \begin{equation}
            \label{eq:resistencia_R_pasa_bajas_ppg}
            R = \frac{1}{2\pi \cdot K \cdot f_c \cdot m \cdot C_1} = \frac{1}{2\pi \cdot 1 \cdot 10 Hz \cdot 0.7071 \cdot 1 \mu F} = 22508.1238 \approx 22 k\Omega
        \end{equation}

        \paragraph{Cálculo de la capacitancia C2}
        La capacitancia $C_2$ se calcula mediante la ecuación~\ref{eq:capacitancia_C2_pasa_bajas_ppg}.

        \begin{equation}
            \label{eq:capacitancia_C2_pasa_bajas_ppg}
            C_2 = m^2 \cdot C_1 = (0.7071)^2 \cdot 1 \mu F \approx 500 nF
        \end{equation}

        Se seleccionó un valor de $C_2 = 470 nF$, ya que es el valor comercial más cercano al calculado.

        \begin{equation}
            C_2 = 470 nF
        \end{equation}

        En la figura~\ref{fig:Simulacion_Filtro_Pasa_Bajas_PPG} se muestra el filtro pasa bajas de segundo orden tipo \textit{Sallen-Key} utilizando las resistencias y los capacitores seleccionados.

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{img/Desarrollo/multisim_pasaBajos_ppg.png}
            \caption[Simulación del filtro pasa bajas de segundo orden \textit{Sallen-Key} para el sensor PPG.]{Simulación del filtro pasa bajas de segundo orden \textit{Sallen-Key} para el sensor PPG\footnotemark}
            \label{fig:Simulacion_Filtro_Pasa_Bajas_PPG}
        \end{figure}
        \footnotetext{Muestra la simulación del filtro pasa bajas de segundo orden \textit{Sallen-Key}
        en el software Multisim, con una frecuencia de corte de 10 Hz.}

        \subsubsection{Filtro Activo Pasa Altas}
        Para el sensor PPG, se implementó un filtro pasa altas de segundo orden tipo \textit{Sallen-Key} para eliminar el ruido de baja frecuencia presente en la señal. Este filtro permite el paso de frecuencias superiores a una frecuencia de corte, mientras atenúa las frecuencias inferiores a esta.

        En el diseño de este filtro, se utilizó una aproximación de Butterworth y los valores de $Q$ y $K$ se obtuvieron de la Tabla~\ref{tab:valores_filtro_pasa_altas}, que presenta los parámetros correspondientes a dicha aproximación.

        \paragraph{Ganancia del Amplificador Operacional}
        En este diseño, al igual que con el filtro pasa altas del ECG, se busca mantener una ganancia unitaria para evitar amplificar la señal y minimizar la introducción de ruido. Esto configura el amplificador operacional como un seguidor de voltaje conectando su salida directamente a la entrada inversora, lo que elimina las resistencias $RA$ y $RB$, simplificando la ganancia del amplificador operacional a la ecuación~\ref{eq:funcion_amplificador_operacional_pasa_altas_ppg}.

        \begin{equation}
            \label{eq:funcion_amplificador_operacional_pasa_altas_ppg}
            A = 1 + \frac{R_b}{R_a} = 1
        \end{equation}

        \paragraph{Cálculo de factor m}
        El factor $m$ es crucial para determinar las resistencias del filtro pasa altas. Se calcula mediante la ecuación~\ref{eq:factor_m_pasa_altas_ppg}.
        \begin{equation}
            \label{eq:factor_m_pasa_altas_ppg}
            m = \frac{1+\sqrt{1+8Q^2(A-1)}}{4Q}
        \end{equation}

        Donde:

        \begin{itemize}
            \item $A$: Ganancia del amplificador operacional.
            \item $Q$: Factor de calidad del filtro.
        \end{itemize}

        Para un filtro Butterworth de segundo orden, que ofrece una respuesta en frecuencia plana en la banda de paso, el factor de calidad $Q$ es igual 0.7071. Sustituyendo los valores de $A = 1$ y $Q = 0.7071$ en la ecuación~\ref{eq:factor_m_pasa_altas_ppg}, se obtiene el valor de $m$.

        \begin{equation}
            \label{eq:factor_m_pasa_altas_ppg_valor}
            m = \frac{1+\sqrt{1+8(0.7071)^2(1-1)}}{4(0.7071)} = \frac{1 + \sqrt{1}}{2.8284}\approx 0.7071
        \end{equation}

        \paragraph{Frecuencia de corte}
        Se seleccionó una frecuencia de corte de $0.5 Hz$ para eliminar el ruido de baja frecuencia presente en la señal de PPG.

        \paragraph{Selección de resistencias $R_1$}
        Para obtener el valor de la resistencia $R_1$, necesitamos escoger un valor para la capacitancia $C$. Se seleccionó un valor de $C = 10 \mu F$. La resistencia $R_1$ se calcula mediante la ecuación~\ref{eq:resistencia_R1_pasa_altas_ppg}.

        \begin{equation}
            \label{eq:resistencia_R1_pasa_altas_ppg}
            R_1 = \frac{m}{2\pi \cdot K \cdot f_c \cdot \cdot C} = \frac{0.7071}{2\pi \cdot 1 \cdot 0.5 Hz \cdot 10 \mu F} = 22507.6920 \Omega \approx 22 k\Omega
        \end{equation}

        \paragraph{Selección de resistencias $R_2$}
        La resistencia $R_2$ se calcula mediante la ecuación~\ref{eq:resistencia_R2_pasa_altas_ppg}.

        \begin{equation}
            \label{eq:resistencia_R2_pasa_altas_ppg}
            R_2 = \frac{R_1}{m^2} = \frac{22.5 k\Omega}{(0.7071)^2} \approx 45 k\Omega
        \end{equation}

        Se utilizó un valor de $R_2 = 47 k\Omega$, ya que es el valor comercial más cercano al calculado.


        \begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{img/Desarrollo/multisim_pasaAltos_ppg.png}
            \caption[Simulación del filtro pasa altas de segundo orden \textit{Sallen-Key} para el sensor PPG.]{Simulación del filtro pasa altas de segundo orden \textit{Sallen-Key} para el sensor PPG\footnotemark}
            \label{fig:Simulacion_Filtro_Pasa_Altas_PPG}
        \end{figure}
        \footnotetext{Muestra el filtro pasa altas de segundo orden \textit{Sallen-Key} en el software Multisim, con una frecuencia de corte de 0.5 Hz.}

        \subsubsection{Filtro Notch Pasivo Rechaza Banda RC Twin-T}

        Para el sensor PPG, se implementó un filtro notch pasivo RC tipo Twin-T para atenuar las interferencias de 60 Hz, comúnmente presentes debido al ruido de la red eléctrica. Este filtro es eficaz para eliminar una frecuencia específica sin afectar significativamente las demás componentes de la señal.

        El filtro Twin-T es un circuito pasivo que utiliza resistencias y capacitores dispuestos en una configuración en forma de ``T'' doble, lo que permite rechazar una frecuencia central $f_0$. Al ser un filtro pasivo, está compuesto únicamente por resistencias y capacitores, lo que simplifica su diseño y construcción. Sin embargo, su factor de calidad $Q$ es limitado, generalmente por debajo de 0.5, lo que implica un ancho de banda relativamente amplio en comparación con filtros activos.

        Para diseñar el filtro notch pasivo RC Twin-T centrado en $f_0 = 60 Hz$, se utilizaron las siguientes ecuaciones:

        Seleccionamos los parámetros iniciales del filtro:
        \begin{itemize}
            \item Frecuencia central $(f_0) = 60 Hz$
            \item Factor de calidad $(Q) = 0.25$
            \item Capacitancia base $(C_1) = 100 nF$
        \end{itemize}

        \paragraph{Cálculo de la resistencia R1}
        La resistencia $R_1$ se calcula mediante la ecuación~\ref{eq:resistencia_R1_notch_ppg}.

        \begin{equation}
            \label{eq:resistencia_R1_notch_ppg}
            R_1 = \frac{1}{4\pi \cdot f_0 \cdot Q \cdot C_1}
        \end{equation}

        Sustituyendo los valores de $f_0 = 60 Hz$, $Q = 0.25$ y $C_1 = 100 nF$ en la ecuación~\ref{eq:resistencia_R1_notch_ppg}, se obtiene el valor de $R_1$.

        \begin{equation}
            R_1 = \frac{1}{4\pi \cdot 60 Hz \cdot 0.25 \cdot 100 nF} = 53051.6477 \Omega \approx 53 k\Omega
        \end{equation}

        \paragraph{Cálculo de la resistencia R2}
        La resistencia $R_2$ se calcula mediante la ecuación~\ref{eq:resistencia_R2_notch_ppg}.

        \begin{equation}
            \label{eq:resistencia_R2_notch_ppg}
            R_2 = \frac{1}{2\pi \cdot f_0 (1 - 2Q) \cdot C_1}
        \end{equation}

        Sustituyendo los valores en la ecuación~\ref{eq:resistencia_R2_notch_ppg}, se obtiene el valor de $R_2$.

        \begin{equation}
            R_2 = \frac{1}{2\pi \cdot 60 Hz(1 - 2(0.25)) \cdot 100 nF} = 53051.6477 \Omega \approx 53 k\Omega
        \end{equation}

        \paragraph{Cálculo de la resistencia R3}
        La resistencia $R_3$ se calcula mediante la ecuación~\ref{eq:resistencia_R3_notch_ppg}.

        \begin{equation}
            \label{eq:resistencia_R3_notch_ppg}
            R_3 = \frac{1}{2\pi \cdot f_0 \cdot C_1}
        \end{equation}

        Sustituyendo los valores en la ecuación~\ref{eq:resistencia_R3_notch_ppg}, se obtiene el valor de $R_3$.

        \begin{equation}
            R_3 = \frac{1}{2\pi \cdot 60 Hz \cdot 100 nF} = 26525.824 \Omega \approx 26.5 k\Omega
        \end{equation}

        \paragraph{Cálculo de la capacitancia C2}
        La capacitancia $C_2$ se calcula mediante la ecuación~\ref{eq:capacitancia_C2_notch_ppg}.

        \begin{equation}
            \label{eq:capacitancia_C2_notch_ppg}
            C_2 = 2Q \cdot C_1
        \end{equation}

        Sustituyendo el valor de $C_1 = 100 nF$ en la ecuación~\ref{eq:capacitancia_C2_notch_ppg}, se obtiene el valor de $C_2$.

        \begin{equation}
            C_2 = 2(0.25) \cdot 100 nF = 50 nF
        \end{equation}

        \paragraph{Cálculo de la capacitancia C3}

        La capacitancia $C_3$ se calcula mediante la ecuación~\ref{eq:capacitancia_C3_notch_ppg}.

        \begin{equation}
            \label{eq:capacitancia_C3_notch_ppg}
            C_3 = (1 - 2Q) \cdot C_1
        \end{equation}

        Sustituyendo los valores, tenemos que:

        \begin{equation}
            C_3 = (1 - 2(0.25)) \cdot 100 nF = 50 nF
        \end{equation}

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{img/Desarrollo/multisim_rechazaBandas.png}
            \caption[Simulación del filtro rechaza banda pasivo RC Twin-T para el sensor PPG.]{Simulación del filtro rechaza banda pasivo RC Twin-T para el sensor PPG\footnotemark}
            \label{fig:Simulacion_Filtro_Rechaza_Banda_PPG}
        \end{figure}
        \footnotetext{Filtro rechaza banda pasivo RC Twin-T en el software Multisim, centrado en 60 Hz.}

        \subsubsection{Amplificador Inversor con fuente única}
        \paragraph{Capacitor de acoplamiento}
        Una vez filtrada la señal del sensor PPG, se incorpora un filtro pasa altas RC de primer orden que conecta en la entrada inversora del amplificador operacional. Este filtro se utiliza para eliminar componentes de corriente continua (0Hz). Para el valor del capacitor se seleccionó la frecuencia de corte de $0.5 Hz$, ya que, los latidos del corazón oscilan entre $1 Hz$ y $2 Hz$ en reposo. Y se calcula mediante la ecuación~\ref{eq:frecuencia_corte_filtro_pasa_altas_continua_ppg}.
        \begin{equation}
            \label{eq:frecuencia_corte_filtro_pasa_altas_continua_ppg}
            f_c = \frac{1}{2\pi R_1 C_1}
        \end{equation}
        Donde $R_1$ se seleccionó como $1k\Omega$, asi que, para el valor de $C_1$ se despeja la ecuación~\ref{eq:frecuencia_corte_filtro_pasa_altas_continua_ppg} y se obtiene el valor de $C_1$.
        \begin{equation}
            C_1 = \frac{1}{2\pi R_1 f_c} = \frac{1}{2\pi (1k\Omega)(0.5Hz)} = 318.3098862 \mu F \approx 318.31 \mu F
        \end{equation}
        Se seleccionó un valor de $C_1 = 330 \mu F$, ya que es el valor comercial más cercano al calculado. El capacitor se conecta en serie a la resistencia $R_1$ y se coloca en la entrada inversora del amplificador operacional. Esto permite eliminar la componente de corriente continua de la señal, dejando solo la componente alterna.

        \paragraph{Ganancia del amplificador inversor}
        Para amplificar la señal del sensor PPG, se utilizó un amplificador inversor. La ganancia del amplificador inversor se calcula mediante la ecuación~\ref{eq:ganancia_amplificador_inversor_ppg}.

        \begin{equation}
            \label{eq:ganancia_amplificador_inversor_ppg}
            V_o = - \frac{R_2}{R_1} \cdot V_i
        \end{equation}

        Donde $V_o$ es la señal de salida, $V_i$ es la señal de entrada. En este caso, se seleccionó $R_2 = 100 k\Omega$. Sustituyendo los valores en la ecuación~\ref{eq:ganancia_amplificador_inversor_ppg}, se obtiene el valor de $V_o$.

        \begin{equation}
            \label{eq:ganancia_amplificador_inversor_ppg_valor}
            V_o = - \frac{100k\Omega}{1k\Omega} \cdot V_i = -100 \cdot V_i
        \end{equation}

        Lo que significa que la señal de salida será 100 veces mayor que la señal de entrada, con una fase invertida. Esto es útil para amplificar la señal del sensor PPG, que generalmente tiene un voltaje de salida bajo.
        
        \paragraph{Desplazamiento de Voltaje}  
        La señal de salida del amplificador inversor oscila entre $-V_{offset}$ y $V_{offset}$. Para que la señal de salida sea compatible con el ADC del ESP32, se necesita que oscile entre 0 y 3.3 V. Para asi, de esta manera evitar saturaciones en el ADC y obtener un rango de lectura adecuado. Esto requiere un desplazamiento de voltaje de aproximadamente 1.65 V, lo cual es la mitad de 3.3V. Para lograr este desplazamiento, se utiliza un amplificador operacional en una configuración de desplazamiento de voltaje. 

        El desplazamiento de 1.65 V se consigue mediante un divisor de voltaje compuesto por dos resistencias. 
        El valor de la resistencia $R_a$ se selecciona como $56k\Omega$ y el valor de la resistencia $R_b$ se calcula de la siguiente manera:

        \begin{equation}
            \label{eq:resistencia_Rb_divisor_ppg}
            R_b = \frac{R_a \cdot V_{offset}}{V_{CC} - V_{offset}}
        \end{equation}

        Donde $V_{CC}$ es la tensión de alimentación del amplificador operacional, que en este caso es de 5V. Sustituyendo los valores en la ecuación~\ref{eq:resistencia_Rb_divisor_ppg}, se obtiene el valor de $R_b$.
        \begin{equation}
            R_b = \frac{56k\Omega \cdot 1.65V}{5V - 1.65V} = 28.2 k\Omega
        \end{equation}
        Se seleccionó un valor de $R_b = 27 k\Omega$, ya que es el valor comercial más cercano al calculado. El divisor de voltaje se conecta entre la alimentación del amplificador operacional y tierra, y se coloca en la entrada no inversora del amplificador operacional. Esto permite desplazar la señal de salida del amplificador inversor a un rango de 0 a 3.3 V.

        Asi que, para verificar que los valores de las resistencias seleccionadas son correctos, se utiliza la ecuación~\ref{eq:desplazamiento_ppg}.
        \begin{equation}
            \label{eq:desplazamiento_ppg}
            V_{out} = \frac{R_b}{R_a + R_b} \cdot V_{CC}
        \end{equation}
        Donde $V_{out}$ es el desplazamiento de voltaje. Sustituyendo los valores en la ecuación~\ref{eq:desplazamiento_ppg}, se obtiene el valor de $V_{out}$.
        \begin{equation}
            V_{out} = \frac{27k\Omega}{56k\Omega + 27k\Omega} \cdot 5V = 1.62 V
        \end{equation}
        Este valor es cercano al desplazamiento de 1.65 V que se buscaba, lo que indica que los valores de las resistencias seleccionadas son correctos. Lo que logra poder visualizar la señal en el ESP32 en el puerto ADC.

        \paragraph{Cálculo de la capacitancia C2}
        Se añade un capacitor en paralelo a la resistencia $R_b$ hacia tierra, esta configuración actua como un filtro pasa bajas RC de primer orden y se encarga de suavizar la tensión de referencia, eliminando ruidos y picos de alta frecuencia. La capacitancia $C_2$ se calcula mediante la ecuación~\ref{eq:capacitancia_C2_desplazamiento_ppg}.

        \begin{equation}
            \label{eq:capacitancia_C2_desplazamiento_ppg}
            C_2 = \frac{1}{2\pi f_c R_b}
        \end{equation}

        Donde $f_c$ es la frecuencia de corte del filtro pasa bajas, que se seleccionó como $5 Hz$. Ya que, para el corazón humano, la frecuencia cardíaca máxima es de aproximadamente $3.4 Hz$, lo que significa que el corazón humano no late más de 200 latidos por minuto. Por lo tanto, se seleccionó una frecuencia de corte de $5 Hz$ como un margen con tolerancia para evitar que la señal de PPG se vea afectada por el filtro pasa bajas.  
        Entonces, sustituyendo los valores en la ecuación~\ref{eq:capacitancia_C2_desplazamiento_ppg}, se obtiene el valor de $C_2$.
        
        \begin{equation}
            C_2 = \frac{1}{2\pi (5 Hz) (27k\Omega)} = 1.178 \mu F
        \end{equation}

        Se seleccionó un valor de $C_2 = 1.0 \mu F$, ya que es el valor comercial más cercano al calculado. El capacitor se conecta en paralelo a la resistencia $R_b$ hacia tierra, lo que permite suavizar la tensión de referencia y eliminar ruidos y picos de alta frecuencia.

        Y asi, se obtiene el circuito del desplazamiento de voltaje para el sensor PPG. En la figura~\ref{fig:Simulacion_Amp_Inversor_PPG} se muestra el amplificador inversor con desplazamiento de voltaje utilizando las resistencias y los capacitores seleccionados.

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{img/Desarrollo/multisim_AmpInversor_ppg.png}
            \caption[Simulación del amplificador inversor con desplazamiento de voltaje para el sensor PPG.]{Simulación del amplificador inversor con desplazamiento de voltaje para el sensor PPG\footnotemark}
            \label{fig:Simulacion_Amp_Inversor_PPG}
        \end{figure}
        \footnotetext{Muestra el amplificador inversor con desplazamiento de voltaje en el software Multisim, con una ganancia de 100 y un desplazamiento de 1.5 V.}

        \subsubsection{Histéresis de la señal de PPG}
        Para mejorar la detección de picos en la señal de PPG, se implementó un circuito de histéresis. Este circuito ayudará a detectar los picos de la señal de PPG inferior, lo cual será importante para calcular la frecuencia cardíaca. 

        Asi que, primero se debe obtener un voltaje de referencia que se ajuste entre 0 y 5V. Por lo cual se utilizó un divisor de voltaje con dos resistencias, $R_1$ y $POT_1$, el potenciometro será el encargado de ajustar el voltaje de referencia.Con lo cual, calculamos el voltaje de referencia mediante la ecuación~\ref{eq:voltaje_referencia_histeresis_ppg}.
        \begin{equation}
            \label{eq:voltaje_referencia_histeresis_ppg}
            V_{ref} = \frac{R_1}{R_1 + POT_1} \cdot V_{CC}
        \end{equation}
        Donde $V_{CC}$ es la tensión de alimentación del amplificador operacional, que en este caso es de 5V. Se seleccionó el valor de $R_1 = 4.7 k\Omega$ y el valor de $POT_1 = 50 k\Omega$. 
        Sustituyendo los valores en la ecuación~\ref{eq:voltaje_referencia_histeresis_ppg}, se obtiene el valor de $V_{ref}$.
        \begin{equation}
            V_{ref} = \frac{50k\Omega}{4.7k\Omega + 50k\Omega} \cdot 5V = 4.5 V
        \end{equation}
        
        donde el voltaje de referencia tendrá un rango máximo de 4.5V. Lo cual es suficiente para ajustar en los picos de la señal de PPG, ya que este oscila entre 0 y 3.3V.
        Para obtener el voltaje de referencia mínima, se ajustó el potenciometro al mínimo, de $POT_1 = 1\Omega$, y se calculó el voltaje de referencia mediante la ecuación~\ref{eq:voltaje_referencia_histeresis_ppg}.
        \begin{equation}
            V_{ref} = \frac{1\Omega}{4.7k\Omega + 1\Omega} \cdot 5V = 0.001063 V
        \end{equation}
        Donde el voltaje de referencia tendrá un rango mínimo de 0.001063V. Lo cual es suficiente para ajustar en los picos inferiores de la señal de PPG.
        El voltaje de referencia se conecta a la entrada inversora del amplificador operacional, y la señal de PPG se conecta a la entrada no inversora. Realiza la comparación entre la señal de PPG y el voltaje de referencia, la salida del amplificador operacional mostrará un nivel alto cuando la señal de PPG supere el voltaje de referencia, y un nivel bajo cuando esté por debajo del voltaje de referencia. \\
        
        Esto genera una señal binaria que indica la presencia o ausencia de un pico en la señal de PPG.
        La señal binaria se conecta a la entrada del ESP32, donde se enviará los datos al teléfono móvil para su procesamiento y análisis.
        El circuito de histéresis se muestra en la figura~\ref{fig:Simulacion_Histeresis_PPG}.

        \begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{img/Desarrollo/multisim_histeresis_ppg.png}
            \caption[Simulación del circuito de histéresis para el sensor PPG.]{Simulación del circuito de histéresis para el sensor PPG\footnotemark}
            \label{fig:Simulacion_Histeresis_PPG}
        \end{figure}
        \footnotetext{Muestra el circuito de histéresis en el software Multisim.}
    
        \subsubsection{Simulación del circuito completo para el sensor PPG}

        En la figura~\ref{fig:Simulacion_Circuito_PPG} se muestra el circuito completo para el sensor PPG, que incluye el filtro pasa bajas, el filtro pasa altas, el filtro notch pasivo, el amplificador inversor con desplazamiento de voltaje y el circuito de histéresis. Este circuito está diseñado para acondicionar la señal de PPG y prepararla para su procesamiento en el ESP32.

        \begin{figure}[H]
            \centering
            \includegraphics[width=1.0\textwidth]{img/Desarrollo/multisim_circuitoPPG.png}
            \caption[Diseño del circuito completo para el sensor PPG.]{Diseño del circuito completo para el sensor PPG\footnotemark}
            \label{fig:Simulacion_Circuito_PPG}
        \end{figure}
        \footnotetext{Muestra el circuito completo que se implementó para el sensor PPG en el software Multisim.}

    \subsection{Visualización de la señal de PPG en el osciloscopio}
    En la Figura~\ref{fig:PPG_Osciloscopio} se muestra la señal de PPG acondicionada en el osciloscopio, la cual se visualiza de forma clara y precisa, lista para ser transmitida al ESP32 para su procesamiento y análisis.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.6\textwidth]{img/Desarrollo/ppg_osciloscopio.png}
        \caption[Señal de PPG acondicionada.]{Señal de PPG acondicionada.\footnotemark}
        \label{fig:PPG_Osciloscopio}
    \end{figure}
    \footnotetext{Muestra la señal de PPG acondicionada en el osciloscopio.}

    \subsection{Visualización de la histéresis de PPG en el osciloscopio}

    La figura~\ref{fig:PPG_Osciloscopio_Histeresis} muestra la señal de histéresis de PPG, que se genera al aplicar el circuito de histéresis a la señal acondicionada. Esta señal binaria es crucial para la detección de picos (valles) en la señal de PPG, esto debido a que los valles de la señal de PPG son difíciles de detectar debido a la presencia de ruido y variaciones en la amplitud de la señal. La histéresis ayuda a estabilizar la detección de picos, evitando falsas detecciones causadas por ruidos o fluctuaciones menores en la señal.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.6\textwidth]{img/Desarrollo/ppg_histeresis.png}
        \caption[Señal de histéresis de PPG.]{Señal binaria de histéresis de PPG.\footnotemark}
        \label{fig:PPG_Osciloscopio_Histeresis}
    \end{figure}
    \footnotetext{Señal binaria de histéresis de PPG.}

    \subsection{Visualización de la señal de PPG con histéresis en el osciloscopio} 

    La figura~\ref{fig:PPGconHisteresis} muestra la señal de PPG junto con la señal de histéresis. La señal de histéresis se superpone a la señal de PPG, lo que permite observar cómo la histéresis afecta la detección de valles en la señal de PPG. La histéresis actúa como un umbral que ayuda a filtrar el ruido y las variaciones menores en la señal, lo que facilita la identificación de los picos y valles de la señal de PPG.

    Esta técnica facilita el cálculo del PTT (\textit{Pulse Transit Time}) y la frecuencia cardíaca, ya que permite identificar de manera más precisa los momentos en los que ocurren los valles en la señal de PPG.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.6\textwidth]{img/Desarrollo/histeresisPPG.png}
        \caption[Señal de PPG con histéresis.]{Señal de PPG con histéresis.\footnotemark}
        \label{fig:PPGconHisteresis}
    \end{figure}
    \footnotetext{Señal de PPG con histéresis visualizada en el osciloscopio.}

    \subsection{Desarrollo del código para el ESP32}
    El código para el ESP32 se desarrolló utilizando el editor de código Visual Studio Code, con la extensión PlatformIO. Esta extensión permite programar el ESP32 de manera sencilla y eficiente, facilitando la carga del código en la placa. El código se basa en el lenguaje de programación C++ y utiliza la biblioteca Arduino para interactuar con el hardware del ESP32.

    El código desarrollado para el ESP32 tiene como objetivo principal la adquisición de datos provenientes de sensores biomédicos, específicamente señales de ECG (electrocardiograma) y PPG (fotopletismografía), y la transmisión de estos datos a un teléfono móvil mediante comunicación Bluetooth.

    El programa está estructurado para aprovechar las capacidades del ESP32, especialmente su arquitectura de doble núcleo, lo que permite ejecutar tareas concurrentemente y optimizar el rendimiento.

    \lstinputlisting[
        language=c++,
        caption={Implementación de la multitarea en el ESP32.},
        label={lst:multitarea_esp32},
        firstline=174,
        lastline=192
    ]{code/esp32.cpp}
    
    El envío de datos se realiza utilizando un \texttt{struct}, lo que permite organizar y agrupar la información de manera eficiente. Este \texttt{struct} contiene los datos de los sensores, como la frecuencia cardíaca, la señal de ECG, el timestamp de cada lectura y los valres booleanos de los picos de PPG y ECG.

    \lstinputlisting[
        language=c++,
        caption={Estructura de datos para el envío de información.},
        label={lst:estructura_datos_esp32},
        firstline=14,
        lastline=20
    ]{code/esp32.cpp}

        \subsubsection{Tareas de muestreo y procesamiento de señales (Nucleo 0)}

        El núcleo 0 del ESP32 se encarga de leer periódicamente los datos de los sensores analógicos provenientes de los circuitos acondicionadores de señales. Estos datos se obtienen a través de los pines analógicos del ESP32, que permiten la conversión de señales analógicas a digitales mediante un convertidor analógico-digital (ADC).

        \lstinputlisting[
            language=c++,
            caption={Nucleo 0 del ESP32},
            label={lst:nucleo_0_esp32},
            firstline=76,
            lastline=108
        ]{code/esp32.cpp}

        \subsubsection{Tareas de comunicación Bluetooth (Nucleo 1)}

        El núcleo 1 del ESP32 es el encargado de gestionar la comunicación Bluetooth con el teléfono móvil. Utiliza la biblioteca BluetoothSerial para establecer una conexión Bluetooth y enviar los datos de los sensores al dispositivo móvil. La comunicación se realiza mediante el protocolo Serial, lo que permite una transmisión eficiente de datos,  se utiliza un semáforo que protege la zona crítica de transmisión.

        Además, la comunicación Bluetooth se maneja con un callback que detecta eventos como la conexión o desconexión del cliente, y permite iniciar o detener la transmisión mediante comandos recibidos.

        \lstinputlisting[
            language=c++,
            caption={Nucleo 1 del ESP32},
            label={lst:nucleo_1_esp32},
            firstline=111,
            lastline=138
        ]{code/esp32.cpp}

    \subsection{Desarrollo de la aplicación Android}

        La aplicación Android fue desarrollada utilizando el entorno de desarrollo Android Studio, y se utilizó el lenguaje de programación Kotlin. Se utilizó un teléfono pixel 6 para realizar las pruebas de la aplicación. Esto permitió hacer las pruebas necesarias para la conexión Bluetooth y la visualización de los datos en tiempo real.

        \subsubsection{Inicio de sesión}

        La función \ref{lst:iniciar_sesion_correo} permite a los usuarios iniciar sesión en la aplicación utilizando su correo electrónico y contraseña. Esta función verifica las credenciales del usuario y, si son válidas, permite el acceso a la aplicación. En caso de que el usuario no tenga una cuenta, se le ofrece la opción de crear una cuenta desde la misma pantalla de inicio de sesión.

        \lstinputlisting[
            language=Kotlin,
            caption={Función para iniciar sesión con correo electrónico y contraseña.},
            label={lst:iniciar_sesion_correo},
            firstline=115,
            lastline=143
        ]{code/LoginActivity.kt}

        La función \ref{lst:iniciar_sesion_google} permite a los usuarios iniciar sesión en la aplicación utilizando su cuenta de Google. Esta función utiliza la API de autenticación de Google para iniciar sesión de manera segura y sencilla.
        
        \lstinputlisting[
            language=Kotlin,
            caption={Función para iniciar sesión con cuenta de Google.},
            label={lst:iniciar_sesion_google},
            firstline=211,
            lastline=221
        ]{code/LoginActivity.kt}

        \subsubsection{Obtener el PTT sistólico}

        La función \ref{lst:obtener_ptt_sistolico} calcula el PTT sistólico obteniendo los picos R del electrocardiograma (ECG) y los picos de la señal de fotopletismografía (PPG). Dado que la señal de PPG no cuenta con histéresis, se utiliza un algoritmo de detección de picos para identificar los picos en esta señal, mientras que la señal de ECG sí dispone de histéresis para una detección más precisa de los picos R.

        La función determina el intervalo de tiempo entre cada pico R del ECG y el siguiente pico correspondiente en la señal de PPG, lo que permite obtener el Tiempo de Transmisión del Pulso (PTT) sistólico.


        \lstinputlisting[
            language=Kotlin,
            caption={Función para obtener el PTT sistólico.},
            label={lst:obtener_ptt_sistolico},
            firstline=22,
            lastline=67
        ]{code/PTTCalculator.kt}

        \subsubsection{Obtener el PTT diastólico}

        La función \ref{lst:obtener_ptt_diastolico} calcula el PTT diastólico de manera similar a la función anterior, pero en este caso si se utiliza la histéresis de la señal de PPG para detectar los picos. La función busca el pico R del ECG y el valle correspondiente en la señal de PPG. El intervalo de tiempo entre el pico R y el valle de PPG se utiliza para calcular el PTT diastólico.

        \lstinputlisting[
            language=Kotlin,
            caption={Función para obtener el PTT diastólico.},
            label={lst:obtener_ptt_diastolico},
            firstline=73,
            lastline=98
        ]{code/PTTCalculator.kt}

        \subsubsection{Estimar la presión arterial}

        Se declara los coeficientes de estimación de la presión arterial sistólica y diastólica.. Estos coeficientes se utilizan para calcular la presión arterial a partir del PTT sistólico y diastólico.

        \lstinputlisting[
            language=Kotlin,
            caption={Coeficiente de estimación de la presión arterial.},
            label={lst:coef_estimacion_presion},
            firstline=6,
            lastline=12
        ]{code/BloodPressureCalculator.kt}

        La función \ref{lst:presion_sistolica} estima la presión arterial sistólica a partir del PTT sistólico. Para ello, utiliza la ecuación~\ref{eq:BP2}, la cual modela la relación inversa entre el PTT y la presión arterial sistólica. Esta función recibe como entrada el valor del PTT sistólico y devuelve la presión arterial sistólica estimada.

        \lstinputlisting[
            language=Kotlin,
            caption={Estimación de la presión arterial sistólica.},
            label={lst:presion_sistolica},
            firstline=19,
            lastline=32
        ]{code/BloodPressureCalculator.kt}

        De manera similar, la función \ref{lst:presion_diastolica} estima la presión arterial diastólica a partir del PTT diastólico. También utiliza la ecuación~\ref{eq:BP2} para calcular la presión arterial diastólica. Esta función toma como entrada el valor del PTT diastólico y devuelve la presión arterial diastólica estimada.

        \lstinputlisting[
            language=Kotlin,
            caption={Estimación de la presión arterial diastólica.},
            label={lst:presion_diastolica},
            firstline=39,
            lastline=52
        ]{code/BloodPressureCalculator.kt}

        \subsubsection{Guardar los datos en Firebase}

        La función \ref{lst:guardar_resultados_firebase} se encarga de guardar los resultados obtenidos en Firebase. Esta función toma como entrada los cálculos de la presión arterial sistólica y diastólica, así como los valores del PTT sistólico y diastólico, junto con la fecha y hora de la medición. Utiliza la API de Firebase para almacenar estos datos en la base de datos de Firebase, lo que garantiza que los datos sean accesibles desde cualquier dispositivo con conexión a Internet. Esta funcionalidad facilita el seguimiento y análisis continuo de la salud del usuario, permitiéndole acceder a su historial de mediciones de manera sencilla y en tiempo real.

        \lstinputlisting[
            language=Java,
            caption={Función para guardar los resultados en Firebase.},
            label={lst:guardar_resultados_firebase},
            firstline=28,
            lastline=65
        ]{code/FirebaseDataManager.kt}

        La función \ref{lst:recuperar_resultados_firebase} se encarga de recuperar los resultados almacenados en Firebase. Esta función permite al usuario recuperar las últimas mediciones realizadas y almacenadas en la base de datos. Utiliza la API de Firebase para acceder a los datos y mostrarlos en la aplicación. Esta funcionalidad es útil para que el usuario pueda revisar su historial de mediciones y realizar un seguimiento de su salud a lo largo del tiempo.

        \lstinputlisting[
            language=Java,
            caption={Función para recuperar los resultados de Firebase.},
            label={lst:recuperar_resultados_firebase},
            firstline=97,
            lastline=114
        ]{code/FirebaseDataManager.kt}

\newpage

\section{Resultados}

    En esta sección se presentan los resultados obtenidos durante el desarrollo del proyecto. Se incluyen imágenes de la interfaz de la aplicación Android, así como ejemplos de las señales de PPG y ECG visualizadas en el teléfono móvil. Además, se muestran los resultados de la base de datos de Firebase, donde se almacenan los datos de los usuarios y los resultados obtenidos.

    \subsection{Interfaz de la aplicación Android}

    La aplicación Android fue desarrollada utilizando el entorno de desarrollo Android Studio, y se utilizó el lenguaje de programación Kotlin. La interfaz de la aplicación fue diseñada para ser intuitiva y fácil de usar.

    En la figura~\ref{fig:Android_Login} se muestra la interfaz de inicio de sesión de la aplicación Android. Esta pantalla permite al usuario ingresar su correo electrónico y contraseña para acceder a la aplicación, también puede ingresar usando una cuenta de Google para facilitar el inicio de sesión. 

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/android_login.png}
        \caption[Interfaz de iniciar sesión de la aplicación Android.]{Interfaz de iniciar sesión de la aplicación Android\footnotemark}
        \label{fig:Android_Login}
    \end{figure}
    \footnotetext{Muestra la interfaz que se tiene al iniciar la aplicación Android.}

    Para crear una cuenta, el usuario debe ingresar un correo electrónico y una contraseña. Al presionar el botón de ``Iniciar sesión'', la aplicación verifica si el correo electrónico y la contraseña son válidos. En caso de que no lo sean, aparecerá un checkbox que ofrece la opción de crear una cuenta. 

    Si el usuario selecciona este checkbox, se registrará una nueva cuenta en la base de datos de Firebase con el correo electrónico y la contraseña ingresados.

    En la Figura~\ref{fig:Android_CrearCuenta} se muestra la opción para crear una cuenta desde la interfaz de inicio de sesión.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/android_crearCuenta.png}
        \caption[Opción de crear cuenta desde la interfaz de login.]{Opción de crear cuenta desde la interfaz de login\footnotemark}
        \label{fig:Android_CrearCuenta}
    \end{figure}
    \footnotetext{Se debe seleccionar el checkbox para crear una cuenta e iniciar sesión.}

    El botón de ``Iniciar sesión'' por defecto está deshabilitado. Este botón se habilitará cuando el usuario ingrese un correo electrónico y una contraseña válidos. En la figura~\ref{fig:Android_IniciarSesionCorreo} se que al momento de ingresar un correo válido y una contraseña, el botón de ``Iniciar sesión'' cambia de color y se habilita. Esto indica que el usuario puede iniciar sesión en la aplicación.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/android_iniciarSesionCorreo.png}
        \caption[El usuario puede iniciar sesión con su correo y contraseña.]{El usuario puede iniciar sesión con su correo y contraseña\footnotemark}
        \label{fig:Android_IniciarSesionCorreo}
    \end{figure}
    \footnotetext{Cuando el usuario ponga un correo válido y una contraseña en los campos correspondientes, el botón de iniciar sesión se habilitará.}

    En la figura~\ref{fig:Android_RecuperarPassword} se muestra la opción de ``Olvidé mi contraseña''. Esta opción permite al usuario recuperar su contraseña en caso de que la haya olvidado. Al presionar este botón, el usuario recibirá un correo electrónico con instrucciones para restablecer su contraseña. Es importante destacar que esta opción solo estará disponible si el usuario ha ingresado un correo electrónico válido en el campo correspondiente.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/android_olvidarPassword.png}
        \caption[El usuario puede recuperar su contraseña.]{El usuario puede recuperar su contraseña\footnotemark}
        \label{fig:Android_RecuperarPassword}
    \end{figure}
    \footnotetext{El usuario puede recuperar su contraseña si la ha olvidado presionando el botón de ``Olvidé mi contraseña''.}

    En la interfaz de inicio de sesión, el usuario también tiene la opción de iniciar sesión utilizando su cuenta de Google. Al presionar el botón de ``Iniciar sesión con Google'', se abrirá una ventana emergente que permitirá al usuario seleccionar su cuenta de Google y otorgar los permisos necesarios para acceder a la aplicación. En la figura~\ref{fig:Android_IniciarSesionGoogle} se muestra la interfaz donde el usuario puede iniciar sesión con su cuenta de Google.

    Esta opción es útil para aquellos usuarios que prefieren no crear una cuenta específica para la aplicación y desean utilizar su cuenta de Google existente.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/android_iniciarSesionGoogle.png}
        \caption[El usuario puede iniciar sesión con su cuenta de Google.]{El usuario puede iniciar sesión con su cuenta de Google\footnotemark}
        \label{fig:Android_IniciarSesionGoogle}
    \end{figure}
    \footnotetext{El usuario puede iniciar sesión con su cuenta de Google presionando el botón de ``Iniciar sesión con Google''.}

    Una vez que el usuario ha iniciado sesión correctamente, es redirigido a la pantalla principal. En caso de que el Bluetooth no esté activado, se solicitará al usuario que lo habilite. En la Figura~\ref{fig:Android_PermisosBT} se muestra el mensaje que solicita activar el Bluetooth.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/android_permisosBT.png}
        \caption[Permisos de Bluetooth.]{Permisos de Bluetooth\footnotemark}
        \label{fig:Android_PermisosBT}
    \end{figure}
    \footnotetext{Si el usuario no tiene prendido el Bluetooth, se le solicitará que lo active.}

    Una vez activado el Bluetooth y con la sesión iniciada, el usuario accede a la pantalla principal de la aplicación, donde puede visualizar en tiempo real sus datos fisiológicos. En esta pantalla, se muestran las señales de ECG y PPG graficadas, la frecuencia cardíaca calculada y la presión arterial estimada.

    Asimismo, la interfaz incluye un botón para conectar el dispositivo Bluetooth deseado y otro para iniciar o detener la medición de los datos fisiológicos.

    En la Figura~\ref{fig:Android_PantallaPrincipal} se presenta la interfaz de la pantalla principal de la aplicación Android, mostrando las gráficas y controles mencionados.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/android_pantallaPrincipal.png}
        \caption[Interfaz de la pantalla principal de la aplicación Android.]{Interfaz de la pantalla principal de la aplicación Android\footnotemark}
        \label{fig:Android_PantallaPrincipal}
    \end{figure}
    \footnotetext{Muestra la interfaz de la pantalla principal de la aplicación Android, donde se pueden ver los datos fisiológicos del usuario.}

    Si el usuario intenta iniciar las mediciones sin conectar el dispositivo Bluetooth primero, se mostrará un mensaje de advertencia. En la figura~\ref{fig:Android_ConectarDispPrimero} se muestra el mensaje que indica que el usuario debe conectar el dispositivo Bluetooth antes de iniciar las mediciones.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/android_conectarDispPrimero.png}
        \caption[Mensaje al intentar iniciar las mediciones sin conectar el dispositivo por Bluetooth primero.]{Mensaje al intentar iniciar las mediciones sin conectar el dispositivo por Bluetooth primero\footnotemark}
        \label{fig:Android_ConectarDispPrimero}
    \end{figure}
    \footnotetext{Este mensaje aparece si el usuario intenta iniciar las mediciones sin conectar el dispositivo por Bluetooth primero.}

    Al presionar el botón de ``Dispositivos'', el usuario puede visualizar los dispositivos Bluetooth emparejados previamente con el teléfono móvil. Esta funcionalidad permite al usuario seleccionar el dispositivo Bluetooth al que desea conectarse para recibir los datos fisiológicos en tiempo real. En la figura~\ref{fig:Android_DispositivosBT} se muestra la interfaz de la pantalla donde se pueden visualizar los dispositivos Bluetooth emparejados.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/android_dispositivosBT.png}
        \caption[Interfaz de la pantalla donde se puede visualizar los dispositivos Bluetooth emparejados.]{Interfaz de la pantalla donde se puede visualizar los dispositivos Bluetooth emparejados\footnotemark}
        \label{fig:Android_DispositivosBT}
    \end{figure}
    \footnotetext{Esta interfaz aparece al seleccionar el botón de ``Dispositivos'' en la pantalla principal.}

    Al seleccionar un dispositivo Bluetooth de la lista, se inicia el proceso de conexión. En la figura~\ref{fig:Android_Conectando} se muestra el mensaje que indica que se está intentando conectar al dispositivo Bluetooth seleccionado.

    Este mensaje es importante para que el usuario sepa que la aplicación está intentando establecer una conexión con el dispositivo Bluetooth.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/android_conectando.png}
        \caption[Mensaje de intento de conexión a un dispositivo Bluetooth.]{Mensaje de intento de conexión a un dispositivo Bluetooth\footnotemark}
        \label{fig:Android_Conectando}
    \end{figure}
    \footnotetext{Este mensaje aparece al intentar conectarse a un dispositivo Bluetooth.}

    Si la ocurre un error durante el proceso de conexión o el dispositivo Bluetooth al que se intenta conectar no está disponible, se mostrará un mensaje de error. En la figura~\ref{fig:Android_ErrorConexion} se muestra el mensaje de error que indica que no se pudo establecer la conexión con el dispositivo Bluetooth.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/android_errorConexion.png}
        \caption[Mensaje de error de conexión a un dispositivo Bluetooth.]{Mensaje de error de conexión a un dispositivo Bluetooth\footnotemark}
        \label{fig:Android_ErrorConexion}
    \end{figure}
    \footnotetext{Este mensaje aparece si no se logra conectar al dispositivo Bluetooth.}

    Si la conexión se establece correctamente, se mostrará un mensaje de éxito. En la figura~\ref{fig:Android_ConexionExitosa} se muestra el mensaje que indica que la conexión al dispositivo Bluetooth fue exitosa.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/android_conexionExitosa.png}
        \caption[Mensaje de conexión exitosa a un dispositivo Bluetooth.]{Mensaje de conexión exitosa a un dispositivo Bluetooth\footnotemark}
        \label{fig:Android_ConexionExitosa}
    \end{figure}
    \footnotetext{Este mensaje aparece si se logra conectar al dispositivo Bluetooth correctamente.}

    Una vez conectado el dispositivo Bluetooth, el usuario puede iniciar las mediciones de los datos fisiológicos. Al presionar el botón de ``Iniciar medición'', la aplicación comenzará a recibir y procesar los datos del sensor. En la figura~\ref{fig:Android_Grafica} muestra las graficas de los datos fisiológicos como el electrocardiograma (ECG) y la fotopletismografía (PPG) en tiempo real.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/android_grafica.png}
        \caption[Interfaz de la pantalla donde se visualizan los datos fisiológicos en tiempo real.]{Interfaz de la pantalla donde se visualizan los datos fisiológicos en tiempo real\footnotemark}
        \label{fig:Android_Grafica}
    \end{figure}
    \footnotetext{Muestra al usuario las graficaciones de los datos fisiológicos en tiempo real.}

    La aplicación toma un muestreo de 15 segundos de los datos fisiológicos y los procesa para calcular la frecuencia cardíaca, el PTT (\textit{Pulse Transit Time}) y la presión arterial estimada. Al finalizar el muestreo, se muestran los resultados en la pantalla, además de guardar los datos en la base de datos de Firebase. En la figura~\ref{fig:Android_GraficaResultados} se muestra el mensaje que indica los resultados fueron guardados en la base de datos.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/android_graficaResultados.png}
        \caption[Mensaje al terminar las mediciones.]{Mensaje al terminar las mediciones\footnotemark}
        \label{fig:Android_GraficaResultados}
    \end{figure}
    \footnotetext{Una vez que se termina el muestreo de 15 segundos, se muestran los resultados y se detiene la medición.}

    \subsection{Base de datos de Firebase}
    La aplicación utiliza Firebase como base de datos para almacenar los datos fisiológicos del usuario. Firebase es una plataforma de desarrollo de aplicaciones móviles que proporciona una base de datos en tiempo real, autenticación de usuarios y almacenamiento en la nube. Firebase permite almacenar y sincronizar datos entre la aplicación y la base de datos en tiempo real, lo que facilita el acceso a los datos desde cualquier dispositivo.

    En la Figura~\ref{fig:Firebase_BD_Resultados} se muestra la base de datos de Firebase donde se almacenan los resultados de los datos fisiológicos del usuario. Esta base de datos registra la frecuencia cardíaca, el Tiempo de Tránsito del Pulso (PTT, por sus siglas en inglés) sistólico y diastólico, así como las estimaciones de presión arterial sistólica y diastólica, además de la fecha y hora en que se tomaron los datos.

    Al estar almacenados en Firebase, estos datos pueden ser accedidos desde cualquier dispositivo con conexión a Internet, lo que permite al usuario visualizar su historial simplemente ingresando su correo electrónico y contraseña.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/firebase_BD_resultados.png}
        \caption[Base de datos de Firebase donde se almacenan los resultados.]{Base de datos de Firebase donde se almacenan los resultados\footnotemark}
        \label{fig:Firebase_BD_Resultados}
    \end{figure}
    \footnotetext{Muestra la base de datos de Firebase donde se almacenan los resultados de los datos fisiológicos del usuario.}

    Al momento en el que el usuario crea una cuenta, se almacenan en la base de datos de Firebase el correo electrónico y la fecha de creación de la cuenta. En la figura~\ref{fig:Firebase_BD_Usuarios} se muestra la base de datos de Firebase donde se almacenan estos datos.

    Esta información es importante para la autenticación de usuarios y para mantener un registro de las cuentas creadas en la aplicación. La base de datos de Firebase permite gestionar y almacenar estos datos de manera segura y eficiente.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/firebase_BD_users.png}
        \caption[Base de datos de Firebase donde se almacenan el correo y fecha de creación de la cuenta.]{Base de datos de Firebase donde se almacenan el correo y fecha de creación de la cuenta\footnotemark}
        \label{fig:Firebase_BD_Usuarios}
    \end{figure}
    \footnotetext{Estos datos son almacenados en la base de datos de Firebase al crear una cuenta.}

    Finalmente, en la figura~\ref{fig:Firebase_auth} se muestra la base de datos de Firebase donde se almacenan los datos de autenticación de los usuarios. Estos datos son gestionados por Firebase Authentication.

    Firebase Authentication es un servicio que permite a los desarrolladores autenticar a los usuarios de sus aplicaciones de manera sencilla y segura. Proporciona una variedad de métodos de autenticación, como correo electrónico y contraseña, autenticación de Google, Facebook, entre otros. Esto facilita la implementación de la autenticación en la aplicación y mejora la seguridad de los datos del usuario.

    \begin{figure}[H]
        \centering
        \includegraphics[width=0.8\textwidth]{img/Resultados/firebase_auth.png}
        \caption[Los datos de autenticación de los usuarios se almacenan en Firebase.]{Los datos de autenticación de los usuarios se almacenan en Firebase\footnotemark}
        \label{fig:Firebase_auth}
    \end{figure}
    \footnotetext{Estos datos son almacenados y gestionados por Firebase Authentication.}

\newpage
\section{Análisis de Resultados}

    Durante la fase de pruebas del sistema desarrollado para la estimación de la presión arterial mediante el cálculo del Tiempo de Transmisión del Pulso (PTT) a partir de señales de ECG y PPG, se presentaron diversas dificultades técnicas que impactaron significativamente en la calidad y precisión de los resultados obtenidos.

    En primer lugar, la señal del electrocardiograma (ECG) mostró un nivel considerable de ruido en la mayoría de las pruebas realizadas. Este ruido se manifiesta como fluctuaciones no deseadas y artefactos en la gráfica, lo que dificulta la correcta identificación de los picos R necesarios para calcular los intervalos de tiempo precisos entre eventos cardíacos. La presencia de este ruido puede deberse a múltiples factores, entre ellos interferencias electromagnéticas. Por esta razón, se optó por implementar un circuito con histéresis para detectar los picos R en la señal de ECG, con el fin de minimizar el porcentaje de error al realizar el cálculo del PTT.

    Esta dificultad en el manejo de las señales analógicas impactó directamente en la calidad de los datos procesados. Como resultado, los valores calculados y almacenados en Firebase para la presión arterial sistólica y diastólica presentaron una desviación significativa respecto a los valores esperados de referencia clínica. El margen de error aproximado se estima en un $\pm30\%$, lo cual refleja la imprecisión derivada principalmente del ruido y la dificultad en la detección exacta de los eventos relevantes en las señales.

    El proyecto logró demostrar una alternativa para estimar la presión arterial basada en PTT, validando que es posible realizar este cálculo con señales fisiológicas adquiridas por sensores no invasivos. Sin embargo, el mayor reto identificado fue la gestión y procesamiento adecuado de las señales analógicas. La calidad del ECG y PPG es crítica para obtener resultados confiables, y el ruido presente en estas señales es el principal factor que limita la precisión del sistema.

    En futuras iteraciones, será fundamental mejorar la adquisición de señales mediante mejores sensores, técnicas de filtrado avanzadas y acondicionamiento de la señal para reducir el ruido y mejorar la detección de eventos característicos. También se recomienda evaluar el uso de algoritmos más robustos para la identificación de picos y valles, así como la incorporación de calibraciones personalizadas para mitigar variaciones individuales.

\newpage
\section{Conclusiones}
    
    El presente proyecto se ha desarrollado con el objetivo de diseñar un dispositivo no invasivo capaz de medir la presión arterial utilizando un sensor de fotopletismografía (PPG) y un electrocardiograma (ECG) con el método de \textit{Pulse Transit Time} (PTT). A pesar de las limitaciones y desafíos técnicas encontrados durante el desarrollo, principalmente el alto ruido en las señales analógicas adquiridas, se demostró la viabilidad de la propuesta del sistema. 

    Una mejora clave para futuro sería el diseño y fabricación en placa PCB de manera profesional, ya que la implementación casera utilizada mostró ser propensa a interferencias y ruido, afectando la calidad de las señales. La adopción de componentes SMD y la selección de dispositivos diseñados específicamente para manejar señales biomédicas de bajo voltaje y alto ruido será fundamental para aumentar la precisión y confiabilidad del sistema.

    El impacto de este proyecto es significativo, ya que permite el registro continuo y accesible de la presión arterial del usuario, posibilitando el monitoreo frecuente desde cualquier lugar mediante autenticación segura. Al ser un método no invasivo, fomenta el auto-monitoreo de la salud cardiovascular sin la necesidad de equipos médicos especializados.

    No obstante, el principal desafío pendiente es la reducción del margen de error actual, que ronda aproximadamente un $\pm30\%$. Este margen elevado limita la aceptación y confianza del usuario final en la estimación. Por ello, se deben priorizar mejoras en el acondicionamiento de señales, algoritmos de procesamiento y calibración individualizada para acercar los resultados a estándares clínicos.

    En conclusión, este proyecto representa un avance en la búsqueda de soluciones no invasivas y accesibles para el monitoreo de la presión arterial, con un enfoque en la mejora continua.